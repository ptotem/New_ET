<script type="text/javascript" src="assets/js/zebra_datepicker.js"></script>
<link rel="stylesheet" href="assets/css/default.css" type="text/css">
  <!--<link rel="stylesheet" type="text/css" href="assets/css/style8.css"/>-->

  <section class='section-wrapper'>

      <div class='row-fluid'>

      <div class="span9">
        <div class="row-fluid">
          <div class="span3"  style="margin-top: -75px;">
            <div>
              <div>
                <a class="brand" href="/" style="margin-left: 10px"><%= image_tag "300px-Tokyoship_Home_icon.svg.png", style:"width:50px;" %></a>
              </div>
              <div>
                <img src="/assets/img/logo.png" class="img_style" style="width:200px;">
              </div>
            </div>
          </div>


          <div class="span9" style="margin-top: 45px;">
            <h3>Leader Board
              <% if user_signed_in? %>
              <div><small>Welcom <%= current_user.name %>,Click on any date to view that day's winner</small></div>
              <% end %>
            </h3>
          </div>
        </div>

        <div class="row-fluid"  style="margin-top: 15px;">
          <div class="span12">
            <div>
              <div>
                <div class="tabbable tabs-left">
                  <ul class="nav nav-tabs">
                    <li><a id="win"  href="#daily" data-toggle="tab">Daily Winners</a></li>
                    <li><a id="week" href="#weekly" data-toggle="tab">Weekly Winners</a></li>
                    <li><a href="#monthly" data-toggle="tab">Weekly Leaders</a></li>
                    <li><a href="#grand_prize" data-toggle="tab">Grand Prize Leaders</a></li>
                  </ul>
                  <div class="tab-content">
                    <div class="tab-pane active" id="daily">
                      <div class="row-fluid">
                        <table class="table table-striped table-condensed">
                              <thead>
                              <tr>
                                <th>Name</th>
                              </tr>
                              </thead>
                              <tbody id="daily_winners">
                              </tbody>
                        </table>
                      </div>
                    </div>
                    <div class="tab-pane" id="weekly">
                      <div class="row-fluid">
                        <table class="table table-striped table-condensed">


                        </table>
                      </div>
                    </div>
                    <div class="tab-pane" id="monthly">
                      <div class="row-fluid">
                        <table class="table table-striped table-condensed">
                          <% if @week_leaderboard.blank? %>
                              <h5>No Winners for this week</h5>
                          <% else %>
                              <thead>
                              <tr>
                                <th>Rank</th>
                                <th>Name</th>
                                <th>Score</th>
                              </tr>
                              </thead>
                              <tbody>
                              <% @week_leaderboard.sort_by { |hsh| hsh[:score] }.reverse![0..2].each_with_index do |user,index|%>
                                  <tr>
                                    <td><%= (index+1) %></td>
                                    <td><%= User.find(user[:user_id]).name rescue ""%></td>
                                    <td><%= user[:score]%></td>
                                  </tr>
                              <%end%>
                              </tbody>
                          <% end %>
                        </table>
                      </div>
                    </div>

                    <div class="tab-pane" id="grand_prize">
                      <div class="row-fluid">
                        <table class="table table-striped table-condensed">

                          <% if @month_leaderboard.blank? %>
                              <h5>No Winners for this Month</h5>
                          <% else %>
                              <thead>
                              <tr>
                                <th>Rank</th>
                                <th>Name</th>
                                <th>Score</th>
                              </tr>
                              </thead>
                              <tbody>
                              <% @month_leaderboard.sort_by { |hsh| hsh[:score] }.reverse![0..4].each_with_index do |user,index|%>
                                  <tr>
                                    <td><%= (index+1) %></td>
                                    <td><%= User.find(user[:user_id]).name rescue "" %></td>
                                    <td><%= user[:score]%></td>
                                  </tr>
                              <%end%>
                              </tbody>
                          <% end %>

                        </table>
                      </div>
                    </div>



                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <% if user_signed_in? %>
          <div class='span3'  style="margin-top: 0px;">
            <div class="accordion" id="accordion2">

              <div class="accordion-group">
                <div class="accordion-heading">
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                    <strong><span>Calendar</span></strong>
                  </a>
                </div>
                <div id="collapseOne" class="accordion-body collapse in">
                  <div class="accordion-inner" style="height: 260px;">
                    <div class="blog-categories widget-tp">
                      <input id="datepicker-example13" type="text" style="display:none;">
                      <input id="datepicker-example7" type="text" style="display:none;">
                      <div id="container"></div>
                      <div id="container1" style="display: none;"></div>
                    </div>
                  </div>
                </div>
              </div>




              <div class="accordion-group">
                <div class="accordion-heading">
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
                    <strong><span>Your Score</span><span class="pull-right" id="points"><img src="/assets/loading.gif" style="height:24px;width:24px;"></span></strong>
                  </a>
                </div>
                <div id="collapseTwo" class="accordion-body collapse">
                  <div class="accordion-inner">
                    <div class="blog-categories widget-tp">
                      <ul>
                        <li>
                          <a href="#">Your Current Rank
                            is:<span id="rank" class='pull-right'><img src="/assets/loading.gif" style="height:24px;width:24px;"></span></a>
                        </li>
                        <li>
                          <a href="#">Your Correct Answer Rate
                            is:<span id="percentage" class='pull-right'><img src="/assets/loading.gif" style="height:24px;width:24px;"></span>

                            <div class="progress progress-striped active">
                              <div class="bar bar-success"></div>
                            </div>
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>


              <div class="accordion-group">
                <div class="accordion-heading">
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree">
                    <strong>Recent Activity</strong>
                  </a>
                </div>
                <div id="collapseThree" class="accordion-body collapse">
                  <div class="accordion-inner">
                    <div class="blog-categories widget-tp">
                      <ul id="recent_activity">
                      </ul>
                    </div>
                  </div>
                </div>
              </div>



              <div class="accordion-group">
                <div class="accordion-heading">
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseFour">
                    <strong>Profile</strong>
                  </a>
                </div>
                <div id="collapseFour" class="accordion-body collapse">
                  <div class="accordion-inner">
                    <div class="blog-categories widget-tp">
                      <ul id="user_profile">
                        <li><strong>Nickname</strong> :  <%= current_user.name %></li>
                        <li><strong>Location&nbsp;&nbsp;</strong> :  <%= current_user.location %></li>
                        <li><strong>Industry&nbsp;&nbsp;&nbsp;</strong> :  <%= current_user.industry %></li>
                        <li><button class="btn btn-info" id="profile_page" onclick='window.location="/profile"'>View Profile</button></li>
                        <li><button class="btn btn-info btn-small"  id="change_pwd_btn" onclick="change_password();">Change Password</button></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
      <% else %>
          <div class="span3">
            <div class="white-card">
              <h5>Sign in to know your score</h5>
              <form method="post" id="new_user" class="new_user" action="/users/sign_in" accept-charset="UTF-8"><input type="hidden" value="✓" name="utf8"><input type="hidden" value="ix5agpotFOZqY9iEmWESSCEnqZ2j/wCAbQp7w6N/oJs=" name="authenticity_token">
                <div class="row-fluid">
                  <div class="span12">
                    <div class="input-prepend">
                      <input type="text"  placeholder="Mobile Number" name="user[username]" id="user_username" data-msg-required="Please enter your mobile number" class="required" style="width:102%;">
                    </div>
                  </div>
                </div>

                <div class="row-fluid">
                  <div class="span12">
                    <input type="password" placeholder="Password" name="user[password]" id="user_password" data-msg-required="Please enter your password" class="required" style="width:95%;">
                  </div>
                  <% flash.each do |name, msg| %>
                      <% if name==:alert %>
                          <% msg = "Invalid mobile number and password" %>
                          <%= content_tag :label, msg, :id => "flash_#{name}", :class => "error" if msg.is_a?(String) %>
                      <% end %>
                  <% end %>
                </div>

                <div class="row-fluid">
                  <div class="span12">
                    <input type="submit" value="Sign in" style="width:100%;margin-bottom:10px;" name="commit" id="new_usr_submit" class="btn btn-success">
                  </div>
                </div>

                <div style="text-align: center;" class="row-fluid">
                  <div class="span12">
                    <a class="btn btn-danger" href="#" onclick="view_register();" style="width:88%;margin-bottom:10px;">Not
                      playing yet? Sign up</a>
                  </div>
                </div>


                <div class="row-fluid">
                  <div class="span12" style="text-align: center;">
                    <a onclick="forgot_password();" id="forgot_password_btn" href="#">Forgot Password?</a>
                  </div>
                </div>
              </form>
            </div>

          </div>
      <% end %>

      </div>


      <style type="text/css">
          .Zebra_DatePicker  {
              margin-left: -20px;
          }
      </style>
  </section>

    <div id="refer_box" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          ×
        </button>
        <h3>Reference</h3>
      </div>
      <div class="modal-body">
        <h2>Enter the email address of your friend</h2>

        <div class="row-fluid">
          <div class="span3"></div>
          <div class="span9">
            <input type="text" name="ref_email" id="referance_friend">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <!--<a href="#" class="btn medium" data-dismiss="modal">Cancel</a>-->
        <a href="javascript:void(0);" class="btn medium btn-danger" data-dismiss="modal" id="submit_email">Submit</a>
      </div>
    </div>

    <div id="rec_act_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          ×
        </button>
        <h3>
          Recent Activity
        </h3>
      </div>
      <div class="modal-body">
        <div class="row-fluid">
          <div class="span9">
            <div class="blog-categories widget-tp">
              <ul id="all_recent_activity">

              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">

      </div>

    </div>

    <div id="change_pwd_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <%= form_tag :quiz_change_password do |f| %>
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            ×
          </button>
          <h3>
            Change Password
          </h3>
        </div>
        <div class="modal-body">
          <div class="row-fluid">
            <div class="span9">
              <p>
                <label>Password</label>
                <%= password_field_tag :password %>
              </p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <%= submit_tag "Change", :class => "btn btn-medium btn-primary pull-left" %>
        </div>
    <% end %>
  </div>

  <script>

      function change_password(){
          $('#change_pwd_modal').modal('show');
      }

    $(function(){


        $('#datepicker-example13').Zebra_DatePicker({
            always_visible:$('#container'),
            onSelect:function (view, element) {
                load_winners(view, element)

            }
        });

        $('#datepicker-example7').Zebra_DatePicker({
            always_visible:$('#container1'),
            onSelect:function (view, element) {
                load_weekly_winners(view,element)
            }
        });

        setInterval(function(){
            $('.Zebra_DatePicker').find('.dp_footer').css("display","none");
            $('.Zebra_DatePicker').find('.dp_clear').css("display","none");
            $('.Zebra_DatePicker').find('.dp_header').css("width","100%");


        },10);


      <%if user_signed_in?%>

        var curr_usr_fb_sign_in_count = "<%= current_user.fb_sign_in_count %>";
        var fb_signed_in = <%= current_user.fb_signed_in %>;

        $.ajax({
          url:"/recent_activity",
          type:"get",
          success:function (returning_data) {
            if(returning_data!=''){
              returning_data=returning_data.split(",");
              $('#recent_activity').html();
              $.each(returning_data,function(){
                  recent = this.replace("[", "").replace("]", "").replace('"', '').replace('"', '').replace('"', '');
                  $("#recent_activity").append('<li class="rec_act" onclick="show_rec_act();"><a href="#">' + recent + '</a></li>');
              });
            }
          }
        });

        $.ajax({
            url: "/all_recent_activities",
            type: "get",
            success: function (returning_data) {
                if (returning_data != '') {
                    returning_data = returning_data.split(",");
                    $('#recent_activity').html();
                    $.each(returning_data, function () {
                        recent = this.replace("[", "").replace("]", "").replace('"', '').replace('"', '');
                        $("#all_recent_activity").append('<li><a href="#">' + recent + '</a></li>');
                    });
                }
            }
        });

        if ( fb_signed_in == true) {

            $.ajax({
                url:"/update_fb_sign_in_score",
                type:"get",
                success:function (returning_data) {

                }
            });

        }

        $.ajax({
          url:"/get_score",
          type:"get",
          success:function (returning_data) {
            if(returning_data!=''){
              returning_data=returning_data.split("|");

                var fb_sign_in_score = <%= current_user.fb_sign_in_score.to_i %>;
                var ref_pts = <%= current_user.refer_points.to_i %>;
                var fb_signed_in = <%= current_user.fb_signed_in %>;

                if ( fb_signed_in == true) {
                    $("#points").html(ref_pts + fb_sign_in_score + " Points");
                }
                else{
                    $("#points").html(<%=current_user.refer_points%>+" Points");
                }


              $("#rank").html(<%=User.order(:refer_points).map{|i| i.refer_points}.reverse.index(current_user.refer_points)+1%>);
              $("#percentage").html(returning_data[2]+"%");
              $(".bar").width(parseInt(returning_data[2])+"%");
            }
          }
        });





        function load_winners(viewing,this_obj) {
            var data = {question:[]}
            data["question"].push(this_obj);
            $.ajax({
                url:"<%= load_winner_path %>",
                type:"POST",
                contentType:"application/json",
                data:JSON.stringify(data),
                success:function (data) {
                    if (data == "Not Found") {
                        alert("No Questions")
                    } else {
                        data=data.split(",");
                        $('#daily_winners').html('');
                        $.each(data,function(){
                            recent = this.replace("[", "").replace("]", "").replace('"', '').replace('"', '');
                            $('#daily_winners').append('<tr><td>'+ recent +'</td></tr>')
                        });
                    }
                }
            });
        }


        function load_weekly_winners(viewing,this_obj) {
            var data = {question:[]}
            data["question"].push(this_obj);
            $.ajax({
                url:"<%= load_weekly_winner_path %>",
                type:"POST",
                contentType:"application/json",
                data:JSON.stringify(data),
                success:function (data) {
                    alert(data)
                }
            });
        }




        <%end%>
    });
    var _gaq = [
    ['_setAccount', 'UA-34697555-1'],
    ['_trackPageview']
    ];
    (function (d, t) {
      var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
      g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g, s)
    }(document, 'script'));



    function refer_friend(){
      $('#refer_box').modal('show')
    }

    function show_rec_act(){
        $("#rec_act_modal").modal('show');
    }


    $('#win').click(function(){
       $('#container').show();
       $('#container1').hide();
    });

    $('#week').click(function(){
        $('#container').hide();
        $('#container1').show();
    });


  </script>
