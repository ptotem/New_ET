  <link rel="stylesheet" type="text/css" href="assets/css/style8.css"/>

  <section class='section-wrapper'>

      <!-- Row Start -->
      <div class='row-fluid'>
        <div class='span9'>
          <div>
            <h4 class="section-header">Leader Board</h4>
            <div class="tabbable tabs-left">
            <ul class="nav nav-tabs">
              <li><a href="#daily" data-toggle="tab">Yesterday's Winners</a></li>
              <li><a href="#weekly" data-toggle="tab">Weekly Leaders</a></li>
              <li><a href="#monthly" data-toggle="tab">Monthly Leaders</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="daily">
                <div class="row-fluid">
                  <table class="table table-striped table-condensed">
                    <% if @daily_leaderboard.blank? %>
                      <h5>No Winners for Today</h5>
                    <% else %>
                        <thead>
                        <tr>
                          <th>Rank</th>
                          <th>Name</th>
                          <th>Score</th>
                        </tr>
                        </thead>
                        <tbody>
                        <% @daily_leaderboard.sort_by {|hsh| hsh[:score]}.reverse![0..4].each_with_index do |user,index| %>
                            <tr>
                              <td><%= (index+1) %></td>
                              <td><%= User.find(user[:user_id]).name rescue"" %></td>
                              <td><%= user[:score] %></td>
                            </tr>
                        <% end %>
                        </tbody>
                    <% end %>

                  </table>
                </div>
              </div>
              <div class="tab-pane" id="weekly">
                <div class="row-fluid">
                  <table class="table table-striped table-condensed">
                    <% if @week_leaderboard.blank? %>
                      <h5>No Winners for this week</h5>
                    <% else %>
                        <thead>
                        <tr>
                          <th>Rank</th>
                          <th>Name</th>
                          <th>Score</th>
                        </tr>
                        </thead>
                        <tbody>
                        <% @week_leaderboard.sort_by { |hsh| hsh[:score] }.reverse![0..2].each_with_index do |user,index|%>
                            <tr>
                              <td><%= (index+1) %></td>
                              <td><%= User.find(user[:user_id]).name rescue ""%></td>
                              <td><%= user[:score]%></td>
                            </tr>
                        <%end%>

                        </tbody>
                    <% end %>


                  </table>
                </div>
              </div>
              <div class="tab-pane" id="monthly">
                <div class="row-fluid">
                  <table class="table table-striped table-condensed">
                    <% if @month_leaderboard.blank? %>
                     <h5>No Winners for this Month</h5>
                    <% else %>
                        <thead>
                        <tr>
                          <th>Rank</th>
                          <th>Name</th>
                          <th>Score</th>
                        </tr>
                        </thead>
                        <tbody>
                        <% @month_leaderboard.sort_by { |hsh| hsh[:score] }.reverse![0..4].each_with_index do |user,index|%>
                            <tr>
                              <td><%= (index+1) %></td>
                              <td><%= User.find(user[:user_id]).name rescue "" %></td>
                              <td><%= user[:score]%></td>
                            </tr>
                        <%end%>
                        </tbody>
                    <% end %>



                  </table>
                </div>
              </div>
            </div>
              </div>
          </div>
        </div>
        <div class='span3'>
          <div class="accordion" id="accordion2">
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                  <strong><span>Your Score</span><span class="pull-right" id="points"><img src="/assets/loading.gif" style="height:24px;width:24px;"></span></strong>
                </a>
              </div>
              <div id="collapseOne" class="accordion-body collapse in">
                <div class="accordion-inner">
                  <div class="blog-categories widget-tp">
                    <ul>
                      <li>
                        <a href="#">Your Current Rank
                          is:<span id="rank" class='pull-right'><img src="/assets/loading.gif" style="height:24px;width:24px;"></span></a>
                      </li>
                      <li>
                        <a href="#">Your Correct Answer Rate
                          is:<span id="percentage" class='pull-right'><img src="/assets/loading.gif" style="height:24px;width:24px;"></span>

                          <div class="progress progress-striped active">
                            <div class="bar bar-success"></div>
                          </div>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
                  <strong>Recent Activity</strong>
                </a>
              </div>
              <div id="collapseTwo" class="accordion-body collapse">
                <div class="accordion-inner">
                  <div class="blog-categories widget-tp">
                    <ul id="recent_activity">

                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree">
                  <strong>Profile</strong>
                </a>
              </div>
              <div id="collapseThree" class="accordion-body collapse">
                <div class="accordion-inner">
                  <div class="blog-categories widget-tp">
                    <ul id="user_profile">
                      <li><strong>Nickname</strong> :  <%= current_user.name %></li>
                      <li><strong>Location&nbsp;&nbsp;</strong> :  <%= current_user.location %></li>
                      <li><strong>Industry&nbsp;&nbsp;&nbsp;</strong> :  <%= current_user.industry %></li>
                      <li><button class="btn btn-info" id="profile_page" onclick='window.location="/profile"'>View Profile</button></li>
                      <li><button class="btn btn-info btn-small"  id="change_pwd_btn" onclick="change_password();">Change Password</button></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      <!-- Row End -->

      <!-- Row Start -->



      <!-- Row End -->
    </div>

      <div class='row-fluid' style="margin-top: 5%;">
        <div class="span12">
          <div class="row-fluid">
            <div class='span3' data-toggle="modal" data-target="#cta_box">
              <div class='white-card'>
                <h5>
                  <span class=""><img src="/assets/img/trophy.png" style="width:15%;"/></span>
                  &nbsp;Daily Winners
                </h5>
                <p>Congratulations to <strong>Anuj, Gurpreet, Imran, John and Takimoto</strong> for winning the quiz on 13th October 2013.</p>
              </div>
            </div>
            <div class='span3' data-toggle="modal" data-target="#cta_box">
              <div class='white-card'>
                <h5>
                  <span class=""><img src="/assets/img/sms.png" style="width:15%;"/></span>
                  &nbsp;Play the Game
                </h5>

                <p> Find today's quiz column in The Economic Times and SMS KYET A, B, C or D as your answer to
                  <b>9834344343</b>.
                </p>
              </div>
            </div>

            <!--<div class='span3' data-toggle="modal" data-target="#rule_box">-->  <!--For rule modal -->
            <div class='span3'>
             <a href="/leaderboards" style="text-decoration: none;">
              <div class='white-card' id="rules-white-card">
                <h5>
                  <span class=""><img src="/assets/img/ruleicon.png" style="width:15%;"/></span>
                  &nbsp;The Leaderboard
                </h5>

                <p>Check out your rank in the overall campaign and see how you are placed in the race for the Grand Prize</p>
              </div>
             </a>
            </div>


            <!--<div class='span3' data-toggle="modal" data-target="#refer_box">-->  <!--For reference modal -->
            <div class='span3'>
              <div class='white-card' id="refer-white-card">
                <h5>
                  <span class=""><img src="/assets/img/refericon.png" style="width:15%;"/></span>
                  &nbsp;Refer a friend
                </h5>

                <p>Spread the word amongst your friends. You may get an opportunity to earn bonus points for your referral!</p>
              </div>
            </div>

          </div>
        </div>

      </div>

  </section>

    <div id="refer_box" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          ×
        </button>
        <h3>Reference</h3>
      </div>
      <div class="modal-body">
        <h2>Enter the email address of your friend</h2>

        <div class="row-fluid">
          <div class="span3"></div>
          <div class="span9">
            <input type="text" name="ref_email" id="referance_friend">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <!--<a href="#" class="btn medium" data-dismiss="modal">Cancel</a>-->
        <a href="javascript:void(0);" class="btn medium btn-danger" data-dismiss="modal" id="submit_email">Submit</a>
      </div>
    </div>

    <div id="rec_act_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          ×
        </button>
        <h3>
          Recent Activity
        </h3>
      </div>
      <div class="modal-body">
        <div class="row-fluid">
          <div class="span9">
            <div class="blog-categories widget-tp">
              <ul id="all_recent_activity">

              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">

      </div>

    </div>

  <div id="change_pwd_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <%= form_tag :quiz_change_password do |f| %>
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            ×
          </button>
          <h3>
            Change Password
          </h3>
        </div>
        <div class="modal-body">
          <div class="row-fluid">
            <div class="span9">
              <p>
                <label>Password</label>
                <%= password_field_tag :password %>
              </p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <%= submit_tag "Change", :class => "btn btn-medium btn-primary pull-left" %>
        </div>
    <% end %>
  </div>

  <script>

      function change_password(){
          $('#change_pwd_modal').modal('show');
      }

    $(function(){
      <%if user_signed_in?%>

        var curr_usr_fb_sign_in_count = "<%= current_user.fb_sign_in_count %>";
        var fb_signed_in = <%= current_user.fb_signed_in %>;

        $.ajax({
          url:"/recent_activity",
          type:"get",
          success:function (returning_data) {
            if(returning_data!=''){
              returning_data=returning_data.split(",");
              $('#recent_activity').html();
              $.each(returning_data,function(){
                  recent = this.replace("[", "").replace("]", "").replace('"', '').replace('"', '');
                  $("#recent_activity").append('<li class="rec_act" onclick="show_rec_act();"><a href="#">' + recent + '</a></li>');
              });
            }
          }
        });

        $.ajax({
            url: "/all_recent_activities",
            type: "get",
            success: function (returning_data) {
                if (returning_data != '') {
                    returning_data = returning_data.split(",");
                    $('#recent_activity').html();
                    $.each(returning_data, function () {
                        recent = this.replace("[", "").replace("]", "").replace('"', '').replace('"', '');
                        $("#all_recent_activity").append('<li><a href="#">' + recent + '</a></li>');
                    });
                }
            }
        });

        if ( fb_signed_in == true) {

            $.ajax({
                url:"/update_fb_sign_in_score",
                type:"get",
                success:function (returning_data) {

                }
            });

        }

        $.ajax({
          url:"/get_score",
          type:"get",
          success:function (returning_data) {
            if(returning_data!=''){
              returning_data=returning_data.split("|");

                var fb_sign_in_score = <%= current_user.fb_sign_in_score.to_i %>;
                var ref_pts = <%= current_user.refer_points.to_i %>;
                var fb_signed_in = <%= current_user.fb_signed_in %>;

                if ( fb_signed_in == true) {
                    $("#points").html(ref_pts + fb_sign_in_score + " Points");
                }
                else{
                    $("#points").html(<%=current_user.refer_points%>+" Points");
                }


              $("#rank").html(<%=User.order(:refer_points).map{|i| i.refer_points}.reverse.index(current_user.refer_points)+1%>);
              $("#percentage").html(returning_data[2]+"%");
              $(".bar").width(parseInt(returning_data[2])+"%");
            }
          }
        });
        <%end%>
    });
    var _gaq = [
    ['_setAccount', 'UA-34697555-1'],
    ['_trackPageview']
    ];
    (function (d, t) {
      var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
      g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g, s)
    }(document, 'script'));



    function refer_friend(){
      $('#refer_box').modal('show')
    }

    function show_rec_act(){
        $("#rec_act_modal").modal('show');
    }
  </script>
