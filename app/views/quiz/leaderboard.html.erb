<script type="text/javascript" src="assets/js/zebra_datepicker.js"></script>
<link rel="stylesheet" href="assets/css/default.css" type="text/css">
<script src="assets/jquery.validate.min.js"></script>
<script src="assets/jquery.dependent-selects.js"></script>
<!--<link rel="stylesheet" type="text/css" href="assets/css/style8.css"/>-->

<style>
    .colored-table-header {
        background-color: #00b6bd;
        color: black;
        border-right: 1px solid white;
    }
    a:hover, a:active, a:focus {
        outline: 0;
    }
</style>
<section class='section-wrapper'>

<div class='row-fluid'>

<div class="span9">
  <div class="row-fluid">
    <div class="span3" style="margin-top: -75px;">
      <div>
        <div>
          <a href="/">
            <img src="/assets/img/logo_n_button.png" class="img_style" style="width:200px;">
          </a>
        </div>
      </div>
    </div>


    <div class="span9" style="margin-top: 45px;">
      <h3 style="line-height:1.2em;">Leaderboard
        <% if user_signed_in? %>
            <div>
              <small id="wel_msg">Welcome <%= current_user.name %>! Click on any date to view that day's winner</small>
            </div>
        <% else  %>
            <div>
              <small id="wel_msg">Welcome!</small>
            </div>
        <% end %>
        <h6 style="font-weight: normal;" id="date_display"></h6>
      </h3>
    </div>
  </div>

  <div class="row-fluid" style="margin-top: 15px;">
    <div class="span12">
      <div>
        <div>
          <div class="tabbable tabs-left">
            <ul class="nav nav-tabs">
              <li><a id="win" href="#daily" data-toggle="tab">Daily Winners</a></li>
              <li><a id="week" href="#weekly" data-toggle="tab">Weekly Winners</a></li>
              <li><a href="#monthly" data-toggle="tab" id="weekly_leaders">Weekly Leaders</a></li>
              <li><a href="#grand_prize" data-toggle="tab" id="grand_prize_leaders">Grand Prize Leaders</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="daily">
                <div class="row-fluid">
                  <table class="table table-striped table-condensed">
                    <thead>
                    <tr>
                      <th class="colored-table-header">Sr.No</th>
                      <th class="colored-table-header">Name</th>
                      <th class="colored-table-header">Score</th>
                    </tr>
                    </thead>
                    <tbody id="daily_win_tbody">

                    </tbody>
                  </table>
                </div>
              </div>
              <div class="tab-pane" id="weekly">
                <div class="row-fluid">
                  <table class="table table-striped table-condensed">
                    <thead>
                    <tr>
                      <th class="colored-table-header">Rank</th>
                      <th class="colored-table-header">Name</th>
                      <th class="colored-table-header">Score</th>
                    </tr>
                    </thead>
                    <tbody id="week_win_tbody">

                    </tbody>
                  </table>
                </div>
              </div>
              <div class="tab-pane" id="monthly">
                <div class="row-fluid">
                  <table class="table table-striped table-condensed">
                    <% if @week_leaderboard.blank? %>
                        <h5>Coming soon</h5>
                    <% else %>
                        <thead>
                        <tr>
                          <th class="colored-table-header">Rank</th>
                          <th class="colored-table-header">Name</th>
                          <th class="colored-table-header">Score</th>
                        </tr>
                        </thead>
                        <tbody>
                        <% @week_leaderboard.sort_by { |hsh| hsh[:score] }.reverse![0..9].each_with_index do |user, index| %>
                            <tr>
                              <td><%= (index+1) %></td>
                              <% if !User.find(user[:user_id]).name.blank? %>
                                  <td><%= User.find(user[:user_id]).name %></td>
                              <% else %>
                                  <td>
                                    <% @name = User.find(user[:user_id]).username %>
                                    <% @name[2..7]='XXXXXXX' %>
                                    <%= @name %>
                                  </td>
                              <% end %>
                              <td><%= user[:score] %></td>
                            </tr>
                        <% end %>
                        </tbody>
                    <% end %>
                  </table>
                </div>
              </div>

              <div class="tab-pane" id="grand_prize">
                <div class="row-fluid">
                  <table class="table table-striped table-condensed">

                    <% if @month_leaderboard.blank? %>
                        <h5>Coming soon</h5>
                    <% else %>
                        <thead>
                        <tr>
                          <th class="colored-table-header">Rank</th>
                          <th class="colored-table-header">Name</th>
                          <th class="colored-table-header">Score</th>
                        </tr>
                        </thead>
                        <tbody>
                        <% @month_leaderboard.sort_by { |hsh| hsh[:score] }.reverse![0..9].each_with_index do |user, index| %>
                            <tr>
                              <td><%= (index+1) %></td>
                              <% if !User.find(user[:user_id]).name.blank? %>
                                  <td><%= User.find(user[:user_id]).name %></td>
                              <% else %>
                                  <td>
                                    <% @name= User.find(user[:user_id]).username %>
                                    <% @name[2..7]='XXXXXXX' %>
                                    <%= @name %>
                                  </td>
                              <% end %>
                              <td><%= user[:score] %></td>
                            </tr>
                        <% end %>
                        </tbody>
                    <% end %>

                  </table>
                </div>
              </div>


            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class='span3' style="margin-top: 0px;">
  <div class="accordion" id="accordion2">
    <div class="accordion-group">
      <div class="accordion-heading">
        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
          <strong id="calendar"><span>Calendar</span></strong>
        </a>
      </div>
      <div id="collapseOne" class="accordion-body collapse in">
        <div class="accordion-inner" style="height: 260px;">
          <div class="blog-categories widget-tp">
            <input id="datepicker-example13" type="text" style="display:none;">
            <input id="datepicker-example7" type="text" style="display:none;">

            <div id="container"></div>
            <div id="container1" style="display: none;"></div>
          </div>
        </div>
      </div>
    </div>



    <% if user_signed_in? %>
        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
              <strong><span>Your Score</span><span class="pull-right" id="points"><img src="/assets/loading.gif" style="height:24px;width:24px;"></span></strong>
            </a>
          </div>
          <div id="collapseTwo" class="accordion-body collapse">
            <div class="accordion-inner">
              <div class="blog-categories widget-tp">
                <ul>
                  <li>
                    <a href="#">Your
                      Rank:<span id="rank" class='pull-right'><img src="/assets/loading.gif" style="height:24px;width:24px;"></span></a>
                  </li>
                  <li>
                    <a href="#">Your correct answer rate
                      is:<span id="percentage" class='pull-right'><img src="/assets/loading.gif" style="height:24px;width:24px;"></span>

                      <div class="progress progress-striped active">
                        <div class="bar bar-success"></div>
                      </div>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>


        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree">
              <strong>Recent Activity</strong>
            </a>
          </div>
          <div id="collapseThree" class="accordion-body collapse">
            <div class="accordion-inner">
              <div class="blog-categories widget-tp">
                <ul id="recent_activity">
                </ul>
              </div>
            </div>
          </div>
        </div>


        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseFour">
              <strong>Profile</strong>
            </a>
          </div>
          <div id="collapseFour" class="accordion-body collapse">
            <div class="accordion-inner">
              <div class="blog-categories widget-tp">
                <ul id="user_profile">
                  <li>
                    <strong>Name</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:  <%= current_user.name %>
                  </li>
                  <li><strong>Location&nbsp;&nbsp;</strong> :  <%= current_user.location %></li>
                  <li><strong>Industry&nbsp;&nbsp;&nbsp;</strong> :  <%= current_user.industry %></li>
                  <li>
                    <button class="btn btn-info btn-small" id="profile_page" onclick='window.location="/profile"'>View Profile
                    </button>
                  </li>
                  <li>
                    <button class="btn btn-info btn-small" id="change_pwd_btn" onclick="change_password();">Change
                      Password
                    </button>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        </div>
        <p> To view your name instead of your mobile number, on the leaderboard, update your profile now. </p>

    <% else %>

        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThreee">
              <strong>Sign Up</strong>
            </a>
          </div>
          <div id="collapseThreee" class="accordion-body collapse">
            <div class="accordion-inner">
              <div class="blog-categories widget-tp">
                <div class="white-card">
                  <h5 style="font-size: 16px;">Sign in to know your score</h5>

                  <form method="post" id="new_user" class="new_user" action="/users/sign_in" accept-charset="UTF-8">
                    <input type="hidden" value="✓" name="utf8"><input type="hidden" value="ix5agpotFOZqY9iEmWESSCEnqZ2j/wCAbQp7w6N/oJs=" name="authenticity_token">

                    <div class="row-fluid">
                      <div class="span12">
                        <div class="input-prepend">
                          <input type="text" placeholder="Mobile Number" name="user[username]" id="user_username" data-msg-required="Please enter your mobile number" class="required" style="width:95%;">
                        </div>
                      </div>
                    </div>

                    <div class="row-fluid">
                      <div class="span12">
                        <input type="password" placeholder="Password" name="user[password]" id="user_password" data-msg-required="Please enter your password" class="required" style="width:95%;">
                      </div>
                      <% flash.each do |name, msg| %>
                          <% if name==:alert %>
                              <% msg = "Invalid mobile number and password" %>
                              <%= content_tag :label, msg, :id => "flash_#{name}", :class => "error" if msg.is_a?(String) %>
                          <% end %>
                      <% end %>
                    </div>

                    <div class="row-fluid">
                      <div class="span12">
                        <input type="submit" value="Sign in" style="width:104%;margin-bottom:10px;font-size: 14px;" name="commit" id="new_usr_submit" class="btn btn-success">
                      </div>
                    </div>

                    <div style="text-align: center;" class="row-fluid">
                      <div class="span12">
                        <a class="btn btn-danger" href="#" onclick="view_register();" style="width:88%;margin-bottom:10px;font-size: 14px;">Not
                          Registered? Sign up</a>
                      </div>
                    </div>


                    <div class="row-fluid">
                      <div class="span12" style="text-align: center;">
                        <a onclick="forgot_password();" id="forgot_password_btn" href="#">Forgot Password?</a>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>


        <p>To view your name instead of your mobile number, on the leaderboard and to track your scores reqularly, Sign up now </p>

    <% end %>
    </div>


</div>


<style type="text/css">
    .Zebra_DatePicker {
        margin-left: -20px;
    }

    h6 {
        font-weight: normal;
    }

</style>
</section>

<div id="refer_box" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>Reference</h3>
  </div>
  <div class="modal-body">
    <h2>Enter the email address of your friend</h2>

    <div class="row-fluid">
      <div class="span3"></div>
      <div class="span9">
        <input type="text" name="ref_email" id="referance_friend">
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <!--<a href="#" class="btn medium" data-dismiss="modal">Cancel</a>-->
    <a href="javascript:void(0);" class="btn medium btn-danger" data-dismiss="modal" id="submit_email">Submit</a>
  </div>
</div>

<div id="rec_act_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>
      Recent Activity
    </h3>
  </div>
  <div class="modal-body">
    <div class="row-fluid">
      <div class="span9">
        <div class="blog-categories widget-tp">
          <ul id="all_recent_activity">

          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer">

  </div>

</div>

<div id="change_pwd_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <%= form_tag :quiz_change_password do |f| %>
      <%#= form_tag :html => {:id => "chng_passd"} do |f| %>
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          ×
        </button>
        <h3>
          Enter the new password
        </h3>
      </div>
      <div class="modal-body">
        <div class="row-fluid">

          <div class="span9">

            <p>
              <label>Password</label>
              <%= password_field_tag :password %>
            </p>

            <div id="pass_text" style="display: none;color: red;">Minimum 8 Characters Required</div>
          </div>

        </div>
      </div>

      <div class="modal-footer">
        <div class="btn btn-medium btn-primary pull-left" id="chng_pwd_btn">Change</div>
        <%= submit_tag "Change", :class => "btn btn-medium btn-primary pull-left", :style => "display:none;", :id => "submit_change" %>
      </div>
  <% end %>

</div>

<div id="not_found_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    &nbsp;&nbsp;&nbsp;&nbsp;
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
  </div>
  <div class="modal-body">
    <p>Please select a date between yesterday and 21 October 2013.
      <!--<span id="question_date"></span>-->
    </p>
    <p>Winners feature for weekdays only.</p>

  </div>
</div>



<script>

    function load_winners(viewing, this_obj) {
        var data = {question: []}
        data["question"].push(this_obj);
        $.ajax({
            url: "<%= load_winner_path %>",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function (data) {
                $('#daily_win_tbody').html("");

                if (data == "Not Found") {
                    $('#not_found_modal').modal('show');
                }
                else if (data == "[]" ) {
                    $('#not_found_modal').modal('show');
                }

                else {
                    data = data.split(",");
                    $.each(data, function (key, value) {
                        value = this.replace("[", "").replace("]", "").replace('"', '').replace('"', '');
                        value = value.split("||");
                        var that_id = "rec" + (key + 1);
                        $('#daily_win_tbody').append('<tr id=' + that_id + '></tr>');
                        $('#' + that_id).append('<td>' + (key + 1) + '</td>');
//                          if ((value[0].length > 0)){

                        if ((value[0] == " ") || value[0] == "") {

                            $('#' + that_id).append('<td>' + value[1].replace(value[1].substring(2, 7), "XXXXXXX") + '</td>')
                        }
                        else {
                            $('#' + that_id).append('<td>' + value[0] + '</td>')
                        }

                        $('#' + that_id).append('<td>' + value[2] + '</td>');


                    });
                }

            }
        });
    }


    function load_weekly_winners(viewing, this_obj) {
        var data = {question: []}
        data["question"].push(this_obj);
        $.ajax({
            url: "<%= load_weekly_winner_path %>",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function (data) {
                $('#week_win_tbody').html("");
                $('#date_display').html("");
                if (data == "") {
                    $('#not_found_modal').modal('show');
                }
                else if(data =="Current Week"){
                  //alert(data)
                }
                else {
                    $.each(data, function (i, v) {
                        var this_id = "rec" + (i + 1);
                        $('#week_win_tbody').append('<tr id=' + this_id + '></tr>')
                        $('#' + this_id).append('<td>' + (i + 1) + '</td>')

                        if (v.user_id == "" || v.user_id == " " || v.user_id == null) {
                            $('#' + this_id).append('<td>' + v.usrname.replace(v.usrname.substring(2, 7), "XXXXXXX") + '</td>')
                        }
                        else {
                            $('#' + this_id).append('<td>' + v.user_id + '</td>')
                        }
                        $('#' + this_id).append('<td>' + v.score + '</td>')

                    });
                    $('#date_display').html("Scores are updated daily at 9:00pm from Monday to Friday<h6>Winners for the current week will be announced the following Monday</h6><h6>Leaders for the period " + data[0].week_info + "</h6>")

                }


            }
        });
    }


    function change_password() {
        $('#change_pwd_modal').modal('show');
        $("#pass_text").hide();
        $("#password").val("");
    }

    $("#chng_pwd_btn").click(function () {
        if ($("#password").val().length >= 8) {
            $("#submit_change").trigger("click");
            $("#pass_text").hide();
        }
        else {
            $("#pass_text").show();
        }
    });

    $(function () {


        $('#datepicker-example13').Zebra_DatePicker({
            always_visible: $('#container'),
            onSelect: function (view, element) {
                load_winners(view, element)

            }
        });

        $('#datepicker-example7').Zebra_DatePicker({
            always_visible: $('#container1'),
            onSelect: function (view, element) {
                load_weekly_winners(view, element)
            }
        });

        setInterval(function () {
            $('.Zebra_DatePicker').find('.dp_footer').css("display", "none");
            $('.Zebra_DatePicker').find('.dp_clear').css("display", "none");
            $('.Zebra_DatePicker').find('.dp_header').css("width", "100%");


        }, 10);


        <%if user_signed_in?%>

        var curr_usr_fb_sign_in_count = "<%= current_user.fb_sign_in_count rescue 0 %>";
        var fb_signed_in = <%= current_user.fb_signed_in %>;

        $.ajax({
            url: "/recent_activity",
            type: "get",
            success: function (returning_data) {
                if (returning_data != '') {
                    returning_data = returning_data.split(",");
                    $('#recent_activity').html();
                    $.each(returning_data, function () {
                        recent = this.replace("[", "").replace("]", "").replace('"', '').replace('"', '').replace('"', '');
                        $("#recent_activity").append('<li class="rec_act" onclick="show_rec_act();"><a href="#">' + recent + '</a></li>');
                    });
                }
            }
        });

        $.ajax({
            url: "/all_recent_activities",
            type: "get",
            success: function (returning_data) {
                if (returning_data != '') {
                    returning_data = returning_data.split(",");
                    $('#recent_activity').html();
                    $.each(returning_data, function () {
                        recent = this.replace("[", "").replace("]", "").replace('"', '').replace('"', '');
                        $("#all_recent_activity").append('<li><a href="#">' + recent + '</a></li>');
                    });
                }
            }
        });

        if (fb_signed_in == true) {

            $.ajax({
                url: "/update_fb_sign_in_score",
                type: "get",
                success: function (returning_data) {

                }
            });

        }

        $.ajax({
            url: "/get_score",
            type: "get",
            success: function (returning_data) {
                if (returning_data != '') {
                    returning_data = returning_data.split("|");

                    var fb_sign_in_score = <%= current_user.fb_sign_in_score.to_i rescue 0%>;
                    var ref_pts = <%= current_user.refer_points.to_i %>;
                    var fb_signed_in = <%= current_user.fb_signed_in %>;

                    if (fb_signed_in == true) {
                        $("#points").html(ref_pts + fb_sign_in_score + " Points");
                    }
                    else {
                        $("#points").html(<%=current_user.refer_points%>+" Points");
                    }


                    $("#rank").html(<%=User.order(:refer_points).map{|i| i.refer_points}.reverse.index(current_user.refer_points)+1%>);
                    $("#percentage").html(returning_data[2] + "%");
                    $(".bar").width(parseInt(returning_data[2]) + "%");
                }
            }
        });


        <%end%>
    });
    var _gaq = [
        ['_setAccount', 'UA-34697555-1'],
        ['_trackPageview']
    ];
    (function (d, t) {
        var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
        g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g, s)
    }(document, 'script'));


    function refer_friend() {
        $('#refer_box').modal('show')
    }

    function show_rec_act() {
        $("#rec_act_modal").modal('show');
    }


    $('#win').click(function () {
        $('#container').show();
        $('#container1').hide();
        $('#date_display').html("");
        $('#week_win_tbody').html("");
        <% if user_signed_in?  %>
        $('#wel_msg').html("Welcome <%= current_user.name %>! Click on any date to view that day's winner")
        <% else %>
        $('#wel_msg').html("Welcome! Click on any date to view that day's winner")
        <% end %>

        $('#collapseOne').find(".accordion-inner").css("height", "260px");
        $('#date_display').html('Scores are updated daily at 9:00pm from Monday to Friday');
    });

    $('#week').click(function () {
        $('#container').hide();
        $('#container1').show();
        $('#daily_win_tbody').html("");
        <% if user_signed_in?  %>
        $('#wel_msg').html("Welcome <%= current_user.name %>! Click on any date to view the week's winner");
        <% else %>
        $('#wel_msg').html("Welcome! Click on any date to view the week's winner");
        <% end %>
        $('#collapseOne').find(".accordion-inner").css("height", "260px");
        $('#date_display').html("Scores are updated daily at 9:00pm from Monday to Friday<h6>Winners for the current week will be announced the following Monday</h6>")
    });

    $('#weekly_leaders').click(function () {
        $('#date_display').html("");
        $('#container').hide();
        $('#container1').hide();
        <% if !Question.first.nil? %>
        $('#date_display').html('Scores are updated daily at 9:00pm from Monday to Friday<h6>Leaders for the period ' + '<%= Date.today.at_beginning_of_week.strftime("%d %B %Y") %> to  <%= (Date.today.at_end_of_week-2).strftime("%d %B %Y") %></h6>')
        <% else %>
        $('#date_display').html('Scores are updated daily at 9:00pm from Monday to Friday');
        <% end %>

        <% if user_signed_in?  %>
        $('#wel_msg').html("Welcome <%= current_user.name %>! ")
        <% else %>
        $('#wel_msg').html("Welcome!")
        <% end %>
        $('#collapseOne').find(".accordion-inner").css("height", "0px");
    });

    $('#grand_prize_leaders').click(function () {
        $('#date_display').html("");
        $('#container').hide();
        $('#container1').hide();
        <% if !Question.first.nil? %>
        $('#date_display').html('Scores are updated daily at 9:00pm from Monday to Friday<h6>Leaders for the period ' + '<%= Question.first.insertion_date.strftime("%d %B %Y") %> to  <%= Question.last.insertion_date.strftime("%d %B %Y") %></h6>')
        <% else %>
        $('#date_display').html('Scores are updated daily at 9:00pm from Monday to Friday<h6></h6>')
        <% end %>

        <% if user_signed_in?  %>
        $('#wel_msg').html("Welcome <%= current_user.name %>! ")
        <% else %>
        $('#wel_msg').html("Welcome!")
        <% end %>
//          $('#date_display').prepend("Scores are updated by 9pm Mon-Fri\n")
        $('#collapseOne').find(".accordion-inner").css("height", "0px");
    });


</script>





<style type="text/css">
    #users_dob_3i, #users_dob_2i, #users_dob_1i {
        width: 100px;
    }
</style>







<div id="forgot_password" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="padding: 10px;">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>Forgot Your Password?</h3>
  </div>
  <br>

  <div class="modal-body" style="overflow: hidden">
    <div class="row-fluid">
      <div class="span12">
        <div>
          <p>Enter your mobile number and we will send you a new password</p>
          <%#= text_field_tag :username %>
          <br>

          <div class="input-prepend">
            <span class="add-on">91</span>
            <%= text_field_tag :username %>
            <!--<img src="/assets/loading.gif" style="height:24px;width:24px; display: none;" id="forgot_pwd_wait_img">-->
          </div>
          <p id="not_register_message" style="display: none;">You are not registered. Please, register.</p>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <div class="row-fluid" style="margin-bottom: 10px;">
      <div class="span12">
        <a class="btn btn-success pull-left" href="#" type="button" id="forgot_submit">Send</a>
      </div>
    </div>
  </div>
</div>


<div id="register" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="padding: 10px;">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>Sign Up</h3>
  </div>
  <br>
  <%#= form_for(resource, :as => resource_name, :url => registration_path(resource_name) , :html => {:id => "register_form"}) do |f| %>
  <div class="modal-body" style="overflow: hidden; ">
    <%= form_for :users, :html => {:id => "register_form"} do |f| %>
        <%= devise_error_messages! %>

        <div class="row-fluid">
          <div class="span12">
            <div>
              <%= f.text_field :username, placeholder: "Mobile Number" %>
              <img src="/assets/loading.gif" style="height:24px;width:24px; display: none;" id="register_loading">
              &nbsp;&nbsp;
              <div id="password_submit_text" style="display: none;">Your number is already present in our records. If
                you would like us to send across your password via SMS please click “Send”
              </div>
            </div>
          </div>
        </div>


        <div id="after_register">
          <div class="row-fluid">
            <div class="span12">
              <div>
                <%= f.email_field :email, :autofocus => true, placeholder: "Email" %></div>
            </div>
          </div>


          <div class="row-fluid">
            <div class="span12">
              <div>
                <%= f.text_field :name, placeholder: "Full Name" %></div>
            </div>
          </div>


          <div class="row-fluid">
            <div class="span12">
              <div>
                <%= f.date_select :dob, :order => [:day, :month, :year], :end_year => 1995, :start_year => 1950 %>
              </div>
            </div>
          </div>


          <div class="row-fluid">
            <div class="span12">
              <div>
                <select name="register_location" class="dependent" id="register_location">
                  <option></option>
                  <option value="Andhra Pradesh, Hyderabad">Andhra Pradesh > Hyderabad</option>
                  <option value="Andhra Pradesh, Visakhapatnam">Andhra Pradesh > Visakhapatnam</option>
                  <option value="Assam, Guwahati">Assam > Guwahati</option>
                  <option value="Bihar, Patna">Bihar > Patna</option>
                  <option value="Chandigarh, Chandigarh">Chandigarh > Chandigarh</option>
                  <option value="Chhattisgarh, Raipur">Chhattisgarh > Raipur</option>
                  <option value="Delhi, Delhi">Delhi > Delhi</option>
                  <option value="Gujarat, Ahmedabad">Gujarat > Ahmedabad</option>
                  <option value="Gujarat, Surat">Gujarat > Surat</option>
                  <option value="Gujarat, Vadodara">Gujarat > Vadodara</option>
                  <option value="Haryana, Gurgaon">Haryana > Gurgaon</option>
                  <option value="Jammu and Kashmir, Jammu">Jammu and Kashmir > Jammu</option>
                  <option value="Jammu and Kashmir, Srinagar">Jammu and Kashmir > Srinagar</option>
                  <option value="Jharkhand, Ranchi">Jharkhand > Ranchi</option>
                  <option value="Karnataka, Bangalore">Karnataka > Bangalore</option>
                  <option value="Karnataka, Mysore">Karnataka > Mysore</option>
                  <option value="Kerala, Kochi (Cochin)">Kerala > Kochi (Cochin)</option>
                  <option value="Kerala, Thrissur">Kerala > Thrissur</option>
                  <option value="Kerala, Trivandrum (Thiruvananthapuram)">Kerala > Trivandrum (Thiruvananthapuram)
                  </option>
                  <option value="Madhya Pradesh, Bhopal">Madhya Pradesh > Bhopal</option>
                  <option value="Madhya Pradesh, Indore">Madhya Pradesh > Indore</option>
                  <option value="Maharashtra, Aurangabad">Maharashtra > Aurangabad</option>
                  <option value="Maharashtra, Mumbai">Maharashtra > Mumbai</option>
                  <option value="Maharashtra, Nagpur">Maharashtra > Nagpur</option>
                  <option value="Maharashtra, Pune">Maharashtra > Pune</option>
                  <option value="Orissa, Bhubaneswar">Orissa > Bhubaneswar</option>
                  <option value="Orissa, Cuttack">Orissa > Cuttack</option>
                  <option value="Orissa, Rourkela">Orissa > Rourkela</option>
                  <option value="Puducherry, Puducherry">Puducherry > Puducherry</option>
                  <option value="Punjab, Amritsar">Punjab > Amritsar</option>
                  <option value="Punjab, Jalandhar">Punjab > Jalandhar</option>
                  <option value="Punjab, Ludhiana">Punjab > Ludhiana</option>
                  <option value="Punjab, Patiala">Punjab > Patiala</option>
                  <option value="Rajasthan, Ajmer">Rajasthan > Ajmer</option>
                  <option value="Rajasthan, Jaipur">Rajasthan > Jaipur</option>
                  <option value="Rajasthan, Jodhpur">Rajasthan > Jodhpur</option>
                  <option value="Rajasthan, Udaipur">Rajasthan > Udaipur</option>
                  <option value="Tamil Nadu, Chennai">Tamil Nadu > Chennai</option>
                  <option value="Tamil Nadu, Coimbatore">Tamil Nadu > Coimbatore</option>
                  <option value="Tamil Nadu, Madurai">Tamil Nadu > Madurai</option>
                  <option value="Tamil Nadu, Salem">Tamil Nadu > Salem</option>
                  <option value="Tamil Nadu, Tiruchirappalli">Tamil Nadu > Tiruchirappalli</option>
                  <option value="Tripura, Agartala">Tripura > Agartala</option>
                  <option value="Uttar Pradesh, Agra">Uttar Pradesh > Agra</option>
                  <option value="Uttar Pradesh, Allahabad">Uttar Pradesh > Allahabad</option>
                  <option value="Uttar Pradesh, Bulandshahr">Uttar Pradesh > Bulandshahr</option>
                  <option value="Uttar Pradesh, Ghaziabad">Uttar Pradesh > Ghaziabad</option>
                  <option value="Uttar Pradesh, Kanpur">Uttar Pradesh > Kanpur</option>
                  <option value="Uttar Pradesh, Lucknow">Uttar Pradesh > Lucknow</option>
                  <option value="Uttar Pradesh, Noida">Uttar Pradesh > Noida</option>
                  <option value="Uttar Pradesh, Varanasi">Uttar Pradesh > Varanasi</option>
                  <option value="Uttarakhand, Dehradun">Uttarakhand > Dehradun</option>
                  <option value="West Bengal, Asansol">West Bengal > Asansol</option>
                  <option value="West Bengal, Howrah">West Bengal > Howrah</option>
                  <option value="West Bengal, Kolkata">West Bengal > Kolkata</option>
                  <option value="West Bengal, Siliguri">West Bengal > Siliguri</option>
                </select>
              </div>
            </div>
          </div>


          <div class="row-fluid">
            <div class="span12">
              <div>
                <%= f.select "industry", options_for_select(["Graphic Design", "Architecture & Planning", "Engineering",
                                                             "Cosmetics", "Apparel & Fashion",
                                                             "Consumer Electronics",
                                                             "Furniture",
                                                             "Retail",
                                                             "Import and Export",
                                                             "Luxury Goods & Jewelry",
                                                             "Marketing and Advertising",
                                                             "Market Research",
                                                             "Public Relations and Communications",
                                                             "Human Resources",
                                                             "Banking",
                                                             "Insurance",
                                                             "Financial Services",
                                                             "Accounting",
                                                             "Computer Hardware",
                                                             "Computer Networking",
                                                             "Telecommunications",
                                                             "Information Technology and Services",
                                                             "Chemicals",
                                                             "Mining & Metals",
                                                             "Oil & Energy",
                                                             "Textiles",
                                                             "Electrical/Electronic Manufacturing",
                                                             "Plastics",
                                                             "Packaging and Containers",
                                                             "Media",
                                                             "Animation",
                                                             "Biotechnology",
                                                             "Medical Practice",
                                                             "Hospital & Health Care",
                                                             "Pharmaceuticals",
                                                             "Veterinary",
                                                             "Consumer Services",
                                                             "Entertainment",
                                                             "Leisure, Travel & Tourism",
                                                             "Hospitality",
                                                             "Airlines/Aviation",
                                                            ]), :prompt => "Select industry" %></div>
            </div>
          </div>


          <div class="row-fluid">
            <div class="span12">
              <div>
                <% workx_array = (1..100).to_a.collect { |p| ["#{p}", p] } %>
                <%= f.select(:workx, options_for_select(workx_array), :prompt => "Select work experience") %>
              </div>
            </div>
          </div>

          <div class="row-fluid">
            <div class="span12">
              <p>Any information entered in the above fields will not be shared by The Economic Times with any external
                agency. All data will be treated with strict confidence and used only for the purpose of this game</p>
            </div>
          </div>

        </div>
        </div>
    <% end %>

    <div class="modal-footer">
      <div class="row-fluid" style="margin-bottom: 10px;">
        <div class="span12">
          <a class="btn btn-success pull-left" href="#" type="button" id="register_submit">Sign Up</a>
          <a class="btn btn-info pull-left" href="#" type="button" id="password_submit" style="display:none;">Send</a>
        </div>
      </div>
    </div>
    </div>




<script type="text/javascript">
    var browser;



    function view_register() {
        $('#register').modal('show');
        $('#register_form').find('.dependent').dependentSelects();
        $("#register_form").find('input[name="users[username]"]').val("");
        $("#register_form").find('input[name="users[email]"]').val("");
        $("#register_form").find('input[name="users[name]"]').val("");
        $("#register_form").find('input[name="users[nickname]"]').val("");
        $("#register_form").find('input[name="users[age]"]').val("");
        $("#register_form").find('input[name="register_location"]').val("");
        $("#register_form").find('input[name="users[industry]"]').val("");
        $('#after_register').show();
        $('#password_submit').hide();
        $('#register_submit').show();
        $('#password_submit_text').hide();
    }


    $(function () {

        $("#register_form").find('input[name="users[email]"]').focus(function () {
            $('#register_loading').hide();
        });


        $("#register_form").find('input[name="users[username]"]').on('input', function () {
            $('#after_register').show();
            $('#password_submit').hide();
            $('#password_submit_text').hide();

            $('#register_submit').show();
            $('#register_loading').show();
            var mobile_no = ($("#register_form").find('input[name="users[username]"]').val());
            $('#not_register_message').hide();
            $('#after_register').show();
            var uname_first_char = mobile_no.charAt(0);
            var uname_second_char = mobile_no.charAt(1);
            //console.log(uname_first_char);
            //console.log(uname_second_char);


            if (mobile_no.length > 9) {
                if ((uname_first_char != "9") || (uname_second_char != "1")) {
                    var prepended_mob_no = "91" + ($("#register_form").find('input[name="users[username]"]').val());
                    var data = {username: []}
                    data["username"].push(prepended_mob_no);
                    $.ajax({
                        url: "<%= mobile_no_checking_path %>",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(data),
                        success: function (data) {
                            if (data == "Nothing") {
                                $('#not_register_message').show();
                                $('#after_register').show();
                                $('#register_submit').show();
                                $('#register_loading').show();
                            }
                            else {
                                setTimeout(function () {
                                    $('#password_submit').show();
                                    $('#password_submit_text').show();
                                    $('#after_register').hide();
                                    $('#register_submit').hide();
                                    $('#not_register_message').hide();
                                    $('#register_loading').hide();
                                }, 2000);

                                $('#password_submit').on("click", function () {
                                    var data = {mobile_no: []}
                                    data["mobile_no"].push(prepended_mob_no);
                                    $.ajax({
                                        url: "<%= change_password_path %>",
                                        type: "POST",
                                        contentType: "application/json",
                                        data: JSON.stringify(data),
                                        success: function (data) {
                                            $('#register').modal('hide');
                                        }
                                    });
                                });

                            }
                        }
                    });

                }
            }


        });
    });


    $('#register_submit').on("click", function () {

        if ($("#register_form").find('input[name="users[username]"]').val() == "") {
            alert("Please enter your phone number");
        }
        else if ($("#register_form").find('input[name="users[email]"]').val() == "") {
            alert("Please enter your email");
        }
        else if ($("#register_form").find('input[name="users[name]"]').val() == "") {
            alert("Please enter your name");
        }
        else if ($("#register_form").find('input[name="users[nickname]"]').val() == "") {
            alert("Please enter your nickname");
        }

        else if ($("#register_form").find('#users_age').val() == "") {
            alert("Please enter your Age");
        }
        else if ($("#register_form").find('#users_workx').val() == "") {
            alert("Please enter your Work Experience");
        }
//        else if (($("#register_form").find('#register_location').val()=="") && ($("#register_form").find('.dependent-sub').val()=="")){
//            alert("Please enter your Location") ;
//        }

        else if ($("#register_form").find('#users_industry').val() == "") {
            alert("Please enter your Industry");
        }

        else {
            $('#register_form').attr({
                action: 'my_new_user',
                method: 'post'
            });


            $('#register_form').submit();


        }
    });


    function forgot_password() {
        $('#forgot_password').modal('show');
        $('#forgot_password').find('input[name="username"]').val("");
        $('#forgot_submit').hide();
        $("#forgot_pwd_wait_img").hide();
    }


    $('#forgot_password').find('input[name="username"]').on('input', function () {
        $('#forgot_submit').hide();
        $('#not_register_message').hide();
        var mobile_no = $('#forgot_password').find('input[name="username"]').val();
        if ($('#forgot_password').find('input[name="username"]').val() == "") {
            $("#forgot_pwd_wait_img").hide();
        }

        //console.log(mobile_no.length);

        var uname_first_char = mobile_no.charAt(0);
        var uname_second_char = mobile_no.charAt(1);
        //console.log(uname_first_char);
        //console.log(uname_second_char);


        if (mobile_no.length > 9) {
            if ((uname_first_char != "9") || (uname_second_char != "1")) {
                //$('#forgot_password').find('input[name="username"]').val("91"+mobile_no);
                var prepended_mob_no = "91" + $('#forgot_password').find('input[name="username"]').val();

                console.log(prepended_mob_no);
                var data = {username: []}
                //data["username"].push(mobile_no);
                data["username"].push(prepended_mob_no);
                console.log(data["username"]);
                $.ajax({
                    url: "<%= mobile_no_checking_path %>",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(data),
                    success: function (data) {
                        $('#not_register_message').hide();
                        if (data == "Nothing") {
                            console.log(data);
                            $('#not_register_message').show();
                            $('#forgot_submit').hide();
                            $("#forgot_pwd_wait_img").hide();
                        }
                        else {
                            $('#forgot_submit').show();
                            $("#forgot_pwd_wait_img").hide();
                            $('#not_register_message').hide();
                        }


                        $('#forgot_submit').on("click", function () {

                            var data = {mobile_no: []}
                            //data["mobile_no"].push(mobile_no);
                            data["mobile_no"].push(prepended_mob_no);
                            $.ajax({
                                url: "<%= change_password_path %>",
                                type: "POST",
                                contentType: "application/json",
                                data: JSON.stringify(data),
                                success: function (data) {
                                    $('#forgot_password').modal('hide');
                                }

                            });

                        })


                    }
                });
            }
        }
    });

    $('#new_user').validate({
        onfocusout: function (element, event) {
            if (element.id === "user_username") {
                this.element(element)
            }
        }
    });


    $('#new_user').find('#new_usr_submit').on('click', function (evt) {
        evt.preventDefault();

        var new_usr_uname = $('#new_user').find('#user_username').val();
        var uname_first_char = new_usr_uname.charAt(0);
        var uname_second_char = new_usr_uname.charAt(1);
        console.log(new_usr_uname);
        console.log(uname_first_char);
        console.log(uname_second_char);

        if ((uname_first_char != "9") || (uname_second_char != "1")) {
            console.log("You have entered username " + new_usr_uname);
            $('#new_user').find('#user_username').val("91" + new_usr_uname);
            console.log($('#new_user').find('#user_username').val());
            $('#new_user').attr({
                action: '/users/sign_in',
                method: 'post'
            });
            $('#new_user').submit();
        }
    });


    <% if user_signed_in? %>
    $('.dependent').dependentSelects();
    var curr_usr_sign_in_count = "<%= current_user.sign_in_count %>";
    var display_modal = <%= current_user.display_modal %>;

    if ((curr_usr_sign_in_count <= 1) && (display_modal == false)) {
        $('#edit_profile').modal('show');

        $.ajax({
            url: "/control_edit_profile_modal",
            type: "post",
            success: function (data) {

            }
        });
    }
    <% end %>

</script>


<script>

    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {

            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),

                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)

    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');


    ga('create', 'UA-44964472-1', 'winwithet.com');

    ga('send', 'pageview');


</script>








