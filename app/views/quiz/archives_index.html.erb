<link rel="stylesheet" type="text/css" href="assets/css/style8.css"/>
<link rel="stylesheet" href="assets/css/default.css" type="text/css">


<section class='section-wrapper'>
<div class='row-fluid'>
  <div class='span9'>

    <div class="white-card" id="white-card_archive">
      <div id="archives_content">
        <!--<h4>-->
          <%# Date.today.strftime("%d %b %y") %>
        <!--</h4>-->
           <div class="row-fluid">
             <div class="span12">
               <h3 class="section-header">
                 <span>Question Trail</span>
               </h3>

               <span class="pull-right">
                <button class="btn btn-success" onclick="view_score()">View Answer</button>
                <!--<button class="btn btn-warning" onclick="view_stat()">View Statistics</button>-->
                <a href="#" target="_blank" id="archives_view_article"><button class="btn btn-info" >View Article</button></a>
                </span>
                <span id="tag_list">
                  <h5><%= @yesterday_question.insertion_date.strftime("%d %B %Y, %A") %></h5>
                <%#= raw (@yesterday_question.tag_list.map { |t| link_to t, tag_path(t) }.join(', ')) %>
               </span>
             </div>
           </div>
          <div class="row-fluid">
            <div class="span12">
              <h4 class="question"><%= @question %></h4>
            </div>
          </div>
        <div class="row-fluid">
          <div class="span12">
            <div class="blog-categories widget-tp">
              <ul>
                <li>
                  <div class="answeroptions shadow"><span class="badge badge-warning">A</span>
                    <h4 class="option1" id="<%= @option[0].id %>" style="display:inline;">&nbsp;&nbsp;<%= @option[0].name %>&nbsp;&nbsp;<span class="image_right"></span></h4>
                  </div>
                </li>
                <li>
                  <div class="answeroptions shadow"><span class="badge badge-success">B</span>
                    <h4 class="option2" id="<%= @option[1].id %>" style="display:inline;">&nbsp;&nbsp;<%= @option[1].name %>&nbsp;&nbsp;<span class="image_right"></span></h4>
                  </div>
                </li>
                <li>
                  <div class="answeroptions shadow"><span class="badge badge-important">C</span>
                    <h4 class="option3" id="<%= @option[2].id %>" style="display:inline;">&nbsp;&nbsp;<%= @option[2].name %>&nbsp;&nbsp;<span class="image_right"></span></h4>
                  </div>
                </li>
                <li>
                  <div class="answeroptions shadow"><span class="badge badge-info">D</span>
                    <h4 class="option4" id="<%= @option[3].id %>" style="display:inline;">&nbsp;&nbsp;<%= @option[3].name %>&nbsp;&nbsp;<span class="image_right"></span></h4>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="white-card" id="white-card_quest" style="display: none;">
      <div>
        <h4>
          <% Date.today.strftime("%d %b %y") %></h4>
        <h6>
            <span class="pull-right">
                <button class="btn btn-success" id="correct_option">View Answer</button>
                <!--<button class="btn btn-warning" id="stat_tag">View Statistics</button>-->
              <!--<a href="#" target="_blank" id="tag_article" onclick="view_tag_article();"><button class="btn btn-info" >View Article</button></a>-->
              <a href="#" target="_blank" id="tag_article"><button class="btn btn-info" >View Article</button></a>
            </span>
        </h6>
        <br>
        <h4 class="question" id="que_content"></h4>

        <div class="blog-categories widget-tp" id="bolg_ul_li">
          <ul>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-warning">A</span>
                <h4 id="quest_option1" style="display:inline;">&nbsp;&nbsp;</h4>
              </div>
            </li>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-success">B</span>
                <h4 id="quest_option2" style="display:inline;">&nbsp;&nbsp;</h4>
              </div>
            </li>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-important">C</span>
                <h4 id="quest_option3" style="display:inline;">&nbsp;&nbsp;</h4>
              </div>
            </li>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-info">D</span>
                <h4 id="quest_option4" style="display:inline;">&nbsp;&nbsp;</h4>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>

  <div class="span3">
    <div class="row-fluid">
     <div class="span12">
       <p style="">Click to view the day’s quiz</p>
      <form action="javascript:void(0)" method="post">
        <div>
          <input id="datepicker-example13" type="text" style="display:none;">
          <div id="container" style="margin: 10px 0 0 0"></div>

          <div id="container2" class="blog-side-tags widget-tp" style="max-height: 350px;min-height:350px;overflow-y: scroll;overflow-x: hidden;display: none;max-width:290px;width:290px; ">
            <ul></ul>
          </div>
        </div>
      </form>
     </div>
    </div>


</div>

  <div class='row-fluid' style="margin-top: 5%;">
    <div class="span12">
      <div class="row-fluid">
        <div class='span3' data-toggle="modal" data-target="#cta_box">
          <div class='white-card'>
            <h5>
              <span class=""><img src="/assets/img/trophy.png" style="width:15%;"/></span>
              &nbsp;Daily Winners
            </h5>
            <p>Congratulations to <strong>Anuj, Gurpreet, Imran, John and Takimoto</strong> for winning the quiz on 13th October 2013.</p>
          </div>
        </div>
        <div class='span3' data-toggle="modal" data-target="#cta_box">
          <div class='white-card'>
            <h5>
              <span class=""><img src="/assets/img/sms.png" style="width:15%;"/></span>
              &nbsp;Play the Game
            </h5>

            <p> Find today's quiz column in The Economic Times and SMS KYET A, B, C or D as your answer to
              <b>9834344343</b>.
            </p>
          </div>
        </div>

        <!--<div class='span3' data-toggle="modal" data-target="#rule_box">-->  <!--For rule modal -->
        <div class='span3'>
          <a href="/leaderboards" style="text-decoration: none;">
            <div class='white-card' id="rules-white-card">
              <h5>
                <span class=""><img src="/assets/img/ruleicon.png" style="width:15%;"/></span>
                &nbsp;The Leaderboard
              </h5>

              <p>Check out your rank in the overall campaign and see how you are placed in the race for the Grand Prize</p>
            </div>
          </a>
        </div>


        <!--<div class='span3' data-toggle="modal" data-target="#refer_box">-->  <!--For reference modal -->
        <div class='span3'>
          <div class='white-card' id="refer-white-card">
            <h5>
              <span class=""><img src="/assets/img/refericon.png" style="width:15%;"/></span>
              &nbsp;Refer a friend
            </h5>

            <p>Spread the word amongst your friends. You may get an opportunity to earn bonus points for your referral!</p>
          </div>
        </div>

      </div>
    </div>

  </div>


</div>



</section>

<div id="not_found_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
  </div>
  <div class="modal-body">
    <h3>Sorry, we did not have a question on <span id="question_date"></span></h3>
  </div>
</div>

<div id="view_article" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>Article View</h3>
  </div>
  <div class="modal-body">
    <h2 id="article"></h2>
  </div>
</div>

<div id="view_article_tags" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>Tag Article</h3>
  </div>
  <div class="modal-body">
    <h2 id="article_tags"></h2>
  </div>
</div>


<div id="nothing_tag" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>Tags</h3>
  </div>
  <div class="modal-body">
    <h2>Not Found</h2>
  </div>
</div>




<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
<script type="text/javascript" src="assets/js/zebra_datepicker.js"></script>

<script>
    var correct;
    var quest;
    var tag_quest;
    var date = <%= @date.strftime("%d") %> ;
    var correct_ans_append_count=0;
    $(document).ready(function () {

        //alert(a);

        correct =<%= @correct  %>;
        quest=<%= @yesterday_question.id  %>;
        $('#datepicker-example13').Zebra_DatePicker({
            always_visible:$('#container'),
            onSelect:function (view, element) {
//                $("#" + correct).html("");
                load_quest(view, element)
                correct_ans_append_count=0;

            }
        });

        $('.Zebra_DatePicker').find('.dp_footer').css("display","none");
        //$('td').removeClass('');
        setTimeout(function(){
            load_datepicker(date);
        },1000)


    });

    function load_datepicker(date){
         a=getcurrent(date);
         if (a.length===1){
             $(a).addClass('dp_selected');
         }
         else{
             var curr;
             $(a).each(function(i,v){
                  if(!$(v).hasClass('dp_not_in_month')){
                       curr=$(v)
                  }
             })
             curr.addClass('dp_selected');
         }
    }

    function getcurrent(ar_date){
        //$('.dp_daypicker>td').filter(function(){
            return $('td:contains("'+ar_date+'")');
        //});
    }

    function view_score() {
        if (correct_ans_append_count==0){
            $("#" + correct).append('<img src="assets/img/right.png" style="margin-left: 2%;">');
        }
        correct_ans_append_count=correct_ans_append_count+1
    }

    function view_article() {
        $('#view_article').modal('show')
    }




    function view_stat() {
        window.location = "/view_question_stat/" + quest;
    }

    function load_quest(viewing,this_obj) {

        var data = {question:[]}
        data["question"].push(this_obj);
        $.ajax({
            url:"<%= load_question_path %>",
            type:"POST",
            contentType:"application/json",
            data:JSON.stringify(data),
            success:function (data) {
                if (data == "Not Found") {
                    $('#not_found_modal').modal('show');
                    $('#question_date').html("");
                    var quiz_date=data.toString().split('|')[10];
                    $('#question_date').html(this_obj);
                } else {
                    $('#article').html("");
                    $('#archives_view_article').attr('href',"");

                    $('#tag_article').attr('href',"");

                    $('#tag_list').html("");

                    var question = data.toString().split('|')[0];
                    var a1 = data.toString().split('|')[1];
                    var a2 = data.toString().split('|')[2];
                    var a3 = data.toString().split('|')[3];
                    var a4 = data.toString().split('|')[4];
                    correct = data.toString().split('|')[5];
                    quest = data.toString().split('|')[6];
                    var image = data.toString().split('|')[7];
                    var tags = data.toString().split('|')[8];
                    var insertion_date=data.toString().split('|')[9];
                    var quiz_date=data.toString().split('|')[10];
                    $('.question').html(question);


                    $('.option1').attr('id', a1.toString().split(';')[0]);
                    $('.option1').html(a1.toString().split(';')[1]);

                    $('.option2').attr('id', a2.toString().split(';')[0]);
                    $('.option2').html(a2.toString().split(';')[1]);

                    $('.option3').attr('id', a3.toString().split(';')[0]);
                    $('.option3').html(a3.toString().split(';')[1]);

                    $('.option4').attr('id', a4.toString().split(';')[0]);
                    $('.option4').html(a4.toString().split(';')[1]);

                    $('#article').append('<img  src=' + image + '>');
                    $('#archives_view_article').attr('href',image);

                    $('#tag_article').attr('href',image);

                    $('#tag_list').append('<h5>'+ quiz_date +'</h5>');
                    load_datepicker(insertion_date);


                }
            }
        });
    }


    $('#tag_search').click(function () {
        var tag = ($('#field1').val());
        var data = {tag:[]}
        data["tag"].push(tag);
        $.ajax({
            url:"<%= tag_list_path %>",
            type:"POST",
            contentType:"application/json",
            data:JSON.stringify(data),
            dataType:'json',
            success:function (data) {
                if (data == "Nothing"){
                    $('#nothing_tag').modal('show');
                }
                else{
                    $('#article_tags').html("");
                    $('#container').hide();
                    $('#white-card_archive').hide();
                    $('#white-card_quest').show();
                    $('#backing').show();
                    $('#tag_area').hide();
                    $('#tag_search').hide();
                    $.each(data, function (key, value) {
                        value = value.split('|');
                        $('#container2').show();
                        $('#container2 ul').append('<li class="insert_li" id=' + value[0] + '><a href="# '+(key+1)+' "data-toggle="tab" class="side-tag"> '+ value[1] + '</a></li>');
                    });

                    $('.insert_li').on('click', function () {
                        correct_ans_append_count=0;
                        $('#que_content').html('');
                        $('#bolg_ul_li').find("input[value='true']").parent().css("background","white");
                        $.ajax({
                            url:"/question_details/"+$(this).attr('id'),
                            type:"GET",
                            success:function (data) {
                                var value = data.split('||');
                                $('#que_content').html(value[0]);
                                $('#article').append('<img  src=' + value[4] + '>');
                                tag_quest=value[5];
                                options = value[1].split("&&");
                                ids = value[2].split("&&");
                                is_correct = value[3].split("&&");
                                $.each(options, function (index, element) {
                                    $('#quest_option'+(index+1)).html(element);
                                });
                                $.each(is_correct, function (ind, ele) {
                                    $('#quest_option'+(ind+1)).append('<input type="hidden" value=' + ele + '>');
                                });

                            }
                        })
                    });
                }

            }
        });
    });


    $('#correct_option').on("click",function(){
        if (correct_ans_append_count==0){
            $('#bolg_ul_li').find("input[value='true']").parent().append('<img src="assets/img/right.png" style="margin-left: 2%;">');
        }
        correct_ans_append_count=correct_ans_append_count+1

    });

    $('#backing').on("click",function(){
        window.location="/archives"
    });

    $('#tag_article').on("click",function(){
//          $('#view_article_tags').modal('show')
    });

    $('#stat_tag').on("click",function(){
       window.location=  "/view_question_stat/" + tag_quest;
    });

</script>
