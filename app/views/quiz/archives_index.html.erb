<link rel="stylesheet" type="text/css" href="assets/css/style8.css"/>
<link rel="stylesheet" href="assets/css/default.css" type="text/css">

<section class='section-wrapper'>
<div class='container'>
<div class='row'>
  <div class='span9'>
    <h3 class="section-header">
      <span><!-- <img src="assets/img/recent.png" style="width:7%;">&nbsp; -->Archives</span></h3>

    <div class="white-card" id="white-card_archive">
      <div id="archives_content">
        <h4>
          <% Date.today.strftime("%d %b %y") %></h4>
        <h6>
            <span id="tag_list">
                <%#= raw (@yesterday_question.tag_list.map { |t| link_to t, tag_path(t) }.join(', ')) %>
            </span>

            <span class="pull-right">
                <button class="btn btn-success" onclick="view_score()">View Answer</button>
                <button class="btn btn-warning" onclick="view_stat()">View Statistics</button>
                <button class="btn btn-info" onclick="view_article()">View Article</button>
            </span>
        </h6>
        <br>
        <h4 class="question"><%= @question %></h4>

        <div class="blog-categories widget-tp">
          <ul>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-warning">A</span>
                <h4 class="option1" id="<%= @option[0].id %>" style="display:inline;">&nbsp;&nbsp;<%= @option[0].name %></h4>
              </div>
            </li>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-success">B</span>
                <h4 class="option2" id="<%= @option[1].id %>" style="display:inline;">&nbsp;&nbsp;<%= @option[1].name %></h4>
              </div>
            </li>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-important">C</span>
                <h4 class="option3" id="<%= @option[2].id %>" style="display:inline;">&nbsp;&nbsp;<%= @option[2].name %></h4>
              </div>
            </li>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-info">D</span>
                <h4 class="option4" id="<%= @option[3].id %>" style="display:inline;">&nbsp;&nbsp;<%= @option[3].name %></h4>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="white-card" id="white-card_quest" style="display: none;">
      <div>
        <h4>
          <% Date.today.strftime("%d %b %y") %></h4>
        <h6>
            <span class="pull-right">
                <button class="btn btn-success" id="correct_option">View Answer</button>
                <button class="btn btn-warning" id="stat_tag">View Statistics</button>
                <button class="btn btn-info" id="tag_article">View Article</button>
            </span>
        </h6>
        <br>
        <h4 class="question" id="que_content"></h4>

        <div class="blog-categories widget-tp" id="bolg_ul_li">
          <ul>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-warning">A</span>
                <h4 id="quest_option1" style="display:inline;">&nbsp;&nbsp;</h4>
              </div>
            </li>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-success">B</span>
                <h4 id="quest_option2" style="display:inline;">&nbsp;&nbsp;</h4>
              </div>
            </li>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-important">C</span>
                <h4 id="quest_option3" style="display:inline;">&nbsp;&nbsp;</h4>
              </div>
            </li>
            <li>
              <div class="answeroptions shadow"><span class="badge badge-info">D</span>
                <h4 id="quest_option4" style="display:inline;">&nbsp;&nbsp;</h4>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>

  <div class="span3">
    <div class="row-fluid">
     <div class="span12">
      <form action="javascript:void(0)" method="post">
        <div>
          <input id="datepicker-example13" type="text" style="display:none;">
          <div id="container" style="margin: 10px 0 0 0"></div>

          <div id="container2" class="blog-side-tags widget-tp" style="max-height: 350px;min-height:350px;overflow-y: scroll;overflow-x: hidden;display: none;max-width:290px;width:290px; ">
            <ul></ul>
          </div>
        </div>
      </form>
     </div>
    </div>

    <div class="row-fluid">
      <div class="span12">
        <button class="btn btn-success" id="backing" style="display: none;width: 100%;">Back</button>
      </div>
    </div>


    <div class="row-fluid" style="margin-top:250px;" id="tag_area">
      <div class="span12">
        <input type="hidden" name="count" value="1"/>
        <div class="control-group" id="fields">
          <label class="control-label" for="field1">Tag Search</label>
          <div class="controls" id="profs">
            <div class="input-append">
              <input autocomplete="off" id="field1" name="prof1" type="text" placeholder="Search For Specific Questions" data-provide="typeahead" data-items="8" data-source='["Economic Times","Sensex","GDP","RBI","Finance"]'/>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row-fluid">
      <div class="span12">
        <button class="btn btn-success" id="tag_search" style="width:82%;">Search</button>
      </div>
    </div>
  </div>

</div>

<!-- Row End -->

<!-- Row Start -->

<div class='row'>

  <div class='span12'>

    <ul class="ch-grid">
      <li onclick='window.location="/";'>
        <div class="ch-item ch-img-1">
          <div class="ch-info-wrap">
            <a href="#" style="text-decoration:none;">
              <div class="ch-info">
                <div class="ch-info-front ch-img-1"></div>
                <div class="ch-info-back">
                  <h3>Home</h3>
                </div>
              </div>
            </a>
          </div>
        </div>
      </li>
      <li onclick='window.location="/quiz";'>
        <div class="ch-item ch-img-2">
          <div class="ch-info-wrap">
            <a href="#" style="text-decoration:none;">
              <div class="ch-info">
                <div class="ch-info-front ch-img-1"></div>
                <div class="ch-info-back">
                  <h3>Quiz</h3>
                </div>
              </div>
            </a>
          </div>
        </div>
      </li>
      <li onclick='window.location="/archives";'>
        <div class="ch-item ch-img-3">
          <div class="ch-info-wrap">
            <a href="#" style="text-decoration:none;">
              <div class="ch-info">
                <div class="ch-info-front ch-img-1"></div>
                <div class="ch-info-back">
                  <h3>Archives</h3>
                </div>
              </div>
            </a>
          </div>
        </div>
      </li>

      <% if user_signed_in? %>
          <li onclick='window.location="/leaderboards";'>
            <div class="ch-item ch-img-4">
              <div class="ch-info-wrap">
                <a href="#" style="text-decoration:none;">
                  <div class="ch-info">
                    <div class="ch-info-front ch-img-1"></div>
                    <div class="ch-info-back">
                      <h3>Leader Board</h3>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </li>
          <li onclick='window.location="/profile";'>
            <div class="ch-item ch-img-5">
              <div class="ch-info-wrap">
                <a href="#" style="text-decoration:none;">
                  <div class="ch-info">
                    <div class="ch-info-front ch-img-1"></div>
                    <div class="ch-info-back">
                      <h3>Profile</h3>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </li>
      <% end %>

    </ul>
  </div>

</div>

<!-- Row End -->


</div>
</section>

<div id="not_found_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>Question</h3>
  </div>
  <div class="modal-body">
    <h2>Not Found</h2>
  </div>
</div>

<div id="view_article" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>Article View</h3>
  </div>
  <div class="modal-body">
    <h2 id="article"></h2>
  </div>
</div>

<div id="view_article_tags" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>Tag Article</h3>
  </div>
  <div class="modal-body">
    <h2 id="article_tags"></h2>
  </div>
</div>


<div id="nothing_tag" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>Tags</h3>
  </div>
  <div class="modal-body">
    <h2>Not Found</h2>
  </div>
</div>




<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
<script type="text/javascript" src="assets/js/zebra_datepicker.js"></script>

<script>
    var correct;
    var quest;
    var tag_quest;
    $(document).ready(function () {

        correct =<%= @correct  %>;
        quest=<%= @yesterday_question.id  %>;
        $('#datepicker-example13').Zebra_DatePicker({
            always_visible:$('#container'),
            onSelect:function (view, element) {
                $("#" + correct).css("background", "none");
                load_quest(element)

            }
        });

    });

    function view_score() {
        $("#" + correct).css("background", "green");
    }

    function view_article() {
        $('#view_article').modal('show')
    }


    function view_stat() {
        window.location = "/view_question_stat/" + quest;
    }

    function load_quest(this_obj) {
        var data = {question:[]}
        data["question"].push(this_obj);
        $.ajax({
            url:"<%= load_question_path %>",
            type:"POST",
            contentType:"application/json",
            data:JSON.stringify(data),
            success:function (data) {
                if (data == "Not Found") {
                    $('#not_found_modal').modal('show');
                } else {
                    $('#article').html("");
                    $('#tag_list').html("");

                    var question = data.toString().split('|')[0];
                    var a1 = data.toString().split('|')[1];
                    var a2 = data.toString().split('|')[2];
                    var a3 = data.toString().split('|')[3];
                    var a4 = data.toString().split('|')[4];
                    correct = data.toString().split('|')[5];
                    quest = data.toString().split('|')[6];
                    var image = data.toString().split('|')[7];
                    var tags = data.toString().split('|')[8];
                    $('.question').html(question);


                    $('.option1').attr('id', a1.toString().split(';')[0]);
                    $('.option1').html(a1.toString().split(';')[1]);

                    $('.option2').attr('id', a2.toString().split(';')[0]);
                    $('.option2').html(a2.toString().split(';')[1]);

                    $('.option3').attr('id', a3.toString().split(';')[0]);
                    $('.option3').html(a3.toString().split(';')[1]);

                    $('.option4').attr('id', a4.toString().split(';')[0]);
                    $('.option4').html(a4.toString().split(';')[1]);

                    $('#article').append('<img  src=' + image + '>');

                    $('#tag_list').append(tags);
                }
            }
        });
    }


    $('#tag_search').click(function () {
        var tag = ($('#field1').val());
        var data = {tag:[]}
        data["tag"].push(tag);
        $.ajax({
            url:"<%= tag_list_path %>",
            type:"POST",
            contentType:"application/json",
            data:JSON.stringify(data),
            dataType:'json',
            success:function (data) {
                if (data == "Nothing"){
                    $('#nothing_tag').modal('show');
                }
                else{
                    $('#article_tags').html("");
                    $('#container').hide();
                    $('#white-card_archive').hide();
                    $('#white-card_quest').show();
                    $('#backing').show();
                    $('#tag_area').hide();
                    $('#tag_search').hide();
                    $.each(data, function (key, value) {
                        value = value.split('|');
                        $('#container2').show();
                        $('#container2 ul').append('<li class="insert_li" id=' + value[0] + '><a href="# '+(key+1)+' "data-toggle="tab" class="side-tag"> '+ value[1] + '</a></li>');
                    });

                    $('.insert_li').on('click', function () {
                        $('#que_content').html('');
                        $('#bolg_ul_li').find("input[value='true']").parent().css("background","white");
                        $.ajax({
                            url:"/question_details/"+$(this).attr('id'),
                            type:"GET",
                            success:function (data) {
                                var value = data.split('||');
                                $('#que_content').html(value[0]);
                                $('#article').append('<img  src=' + value[4] + '>');
                                tag_quest=value[5];
                                options = value[1].split("&&");
                                ids = value[2].split("&&");
                                is_correct = value[3].split("&&");
                                $.each(options, function (index, element) {
                                    $('#quest_option'+(index+1)).html(element);
                                });
                                $.each(is_correct, function (ind, ele) {
                                    $('#quest_option'+(ind+1)).append('<input type="hidden" value=' + ele + '>');
                                });

                            }
                        })
                    });
                }

            }
        });
    });


    $('#correct_option').on("click",function(){
        $('#bolg_ul_li').find("input[value='true']").parent().css("background","red");
    });

    $('#backing').on("click",function(){
        window.location="/archives"
    });

    $('#tag_article').on("click",function(){
          $('#view_article_tags').modal('show')
    });

    $('#stat_tag').on("click",function(){
       window.location=  "/view_question_stat/" + tag_quest;
    });

</script>
