<link rel="stylesheet" type="text/css" href="assets/css/style8.css" />
<script src="assets/jquery.dependent-selects.js"></script>
<section class='section-wrapper'>


    <div class='row-fluid'>
      <div class="span9">
        <div class="row-fluid">
          <div class="span3"  style="margin-top: -75px;">
            <div>
              <div>
                <a class="brand" href="/" style="margin-left: 10px"><%= image_tag "300px-Tokyoship_Home_icon.svg.png", style:"width:50px;" %></a>
              </div>
              <div>
                <img src="/assets/img/logo.png" class="img_style" style="width:200px;">
              </div>
            </div>
          </div>

          <div class="span9" style="margin-top: 45px;">
            <h3>Profile
              <% if user_signed_in? %>
                 <% if current_user.name.nil? %>
                      <div><small>Welcome!</small></div>
                 <% else %>
                    <div><small>Welcome <%= current_user.name %>!</small></div>
                 <% end %>
              <% end %>

            </h3>
          </div>
        </div>



        <div class="row-fluid">
          <div class="span12">
            <div>
              <div>
                <div class="white-card">

                  <div class="row-fluid" style="margin-top:15px;">

                    <div class="span4">
                      <div class="row-fluid">

                        <%# if !current_user.user_picture.nil? %>
                            <%#= image_tag current_user.user_picture.url,:style => "width:100%;" %>
                        <% if !current_user.picture.nil? %>
                            <%= image_tag current_user.picture, :style =>"width:100%;" %>
                        <% else %>
                            <img src="assets/img/fb-blank-face.jpeg" style="width: 100%;">
                        <% end %>

                      </div>

                        <%#= form_for @user,:url => upload_photo_path, :html => { :multipart => true } do |e| %>
                            <%#= e.file_field :user_picture,:style => "min-width:40px;" %>
                            <%#= e.submit "Submit" %>
                        <%# end %>

                    </div>




                    <div class="span5">
                      <div class="section-header"><%= current_user.name %></div>
                      <div>
                        <ul style="list-style:none;">
                          <li><h4>Age: <%= Date.today.year - current_user.dob.year rescue '' %></h4></li>
                          <li><h4>Work Experience: <%= current_user.workx %> Years</h4></li>
                          <li><h4>Industry: <%= current_user.industry %></h4></li>
                          <li><h4>Location : <%= current_user.location %></h4></li>
                          <!--<li><h4>Facebook Linked: No</h4></li>-->
                        </ul>
                      </div>
                    </div>

                    <div class="span3">
                      <div class="row-fluid" style="text-align:center;">
                        <button class="btn btn-warning btn-small" style="width: 75%;" data-toggle="modal" data-target="#edit_profile">Edit Profile</button>
                      </div>
                      <br>
                      <div class="row-fluid" style="text-align:center;">
                        <!--<a href="/users/auth/facebook"><button class="btn btn-info btn-large" style="margin-left:25px;">Connect With Facebook</button></a>-->
                        <a href="/users/auth/facebook"><img src="assets/img/facebook.jpeg" style="width: 75%;"></a>
                      </div>
                      <br>
                      <div class="row-fluid" style="text-align:center;">
                        <button class="btn btn-info btn-small"  id="change_pwd_btn" onclick="change_password();">Change Password</button>
                      </div>
                    </div>
                  </div>

                </div>


              </div>

            </div>
          </div>

        </div>
      </div>
      <div class='span3'  style="margin-top: 0px;">
        <div class="accordion" id="accordion2">
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                <strong><span>Your Score</span><span class="pull-right" id="points"><img src="/assets/loading.gif" style="height:24px;width:24px;"></span></strong>
              </a>
            </div>
            <div id="collapseOne" class="accordion-body collapse in">
              <div class="accordion-inner">
                <div class="blog-categories widget-tp">
                  <ul>
                    <li>
                          <a href="#">Your Rank
                            is:<span id="rank" class='pull-right'><img src="/assets/loading.gif" style="height:24px;width:24px;"></span></a>
                    </li>
                    <li>
                      <a href="#">Your correct answer rate
                        is:<span id="percentage" class='pull-right'><img src="/assets/loading.gif" style="height:24px;width:24px;"></span>

                        <div class="progress progress-striped active">
                          <div class="bar bar-success"></div>
                        </div>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
                <strong>Recent Activity</strong>
              </a>
            </div>
            <div id="collapseTwo" class="accordion-body collapse">
              <div class="accordion-inner">
                <div class="blog-categories widget-tp">
                  <ul id="recent_activity">

                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


    </div>



</section>
<style type="text/css">
  #user_dob_1i{
      width:100px;
  }
  #user_dob_2i{
      width:100px;
  }
  #user_dob_3i{
      width:100px;
  }
</style>


<div id="edit_profile" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <%= form_tag :update_profile do |f| %>
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          ×
        </button>
        <h3>
          Edit Profile
        </h3>
      </div>
      <div class="modal-body">
        <div class="row-fluid">
          <div class="span9">

            <p>
              <label>e-mail</label>
              <%= email_field_tag :email, @user.email %>
            </p>

            <p>
              <label>Full Name</label>
              <%= text_field_tag :name, @user.name %>
            </p>



            <p>
              <label>Date Of Birth</label>
              <%#= text_field_tag :age, @user.age %>
              <%#= select_tag :age, options_for_select(%w(1 2 3)) %>
              <%#= date_select :dob,@user.dob,:start_year => 1950,:end_year => 2013 %>
              <%= date_select("user", "dob", start_year: 1950, end_year: 1995 ) %>
            </p>

            <p>
              <label>Work Experience (in years)</label>
              <%#= text_field_tag :workx, @user.workx %>
              <% workx_array = (1..100).to_a.collect{|p| ["#{p}", p]} %>
              <%= select_tag(:workx, options_for_select(workx_array, :selected => @user.workx), :prompt => "Work Experience") %>
            </p>

            <p>
              <label> Location (State, City)</label>
              <%#= text_field_tag :location, @user.location %>
              <%#= select_tag "state", options_for_select(["Maharashtra", "Gujarat", "Karnataka", "Andhra Pradesh", "West Bengal"], :selected => @user.state), :prompt => "Select state" %>
              <select name="location" class="dependent">
                <option></option>
                <option value="Andhra Pradesh, Hyderabad">Andhra Pradesh > Hyderabad</option>
                <option value="Andhra Pradesh, Visakhapatnam">Andhra Pradesh > Visakhapatnam</option>
                <option value="Assam, Guwahati">Assam > Guwahati</option>
                <option value="Bihar, Patna">Bihar > Patna</option>
                <option value="Chandigarh, Chandigarh">Chandigarh > Chandigarh</option>
                <option value="Chhattisgarh, Raipur">Chhattisgarh > Raipur</option>
                <option value="Delhi, Delhi">Delhi > Delhi</option>
                <option value="Gujarat, Ahmedabad">Gujarat > Ahmedabad</option>
                <option value="Gujarat, Surat">Gujarat > Surat</option>
                <option value="Gujarat, Vadodara">Gujarat > Vadodara</option>
                <option value="Haryana, Gurgaon">Haryana > Gurgaon</option>
                <option value="Jammu and Kashmir, Jammu">Jammu and Kashmir > Jammu</option>
                <option value="Jammu and Kashmir, Srinagar">Jammu and Kashmir > Srinagar</option>
                <option value="Jharkhand, Ranchi">Jharkhand > Ranchi</option>
                <option value="Karnataka, Bangalore">Karnataka > Bangalore</option>
                <option value="Karnataka, Mysore">Karnataka > Mysore</option>
                <option value="Kerala, Kochi (Cochin)">Kerala > Kochi (Cochin)</option>
                <option value="Kerala, Thrissur">Kerala > Thrissur</option>
                <option value="Kerala, Trivandrum (Thiruvananthapuram)">Kerala > Trivandrum (Thiruvananthapuram)</option>
                <option value="Madhya Pradesh, Bhopal">Madhya Pradesh > Bhopal</option>
                <option value="Madhya Pradesh, Indore">Madhya Pradesh > Indore</option>
                <option value="Maharashtra, Aurangabad">Maharashtra > Aurangabad</option>
                <option value="Maharashtra, Mumbai">Maharashtra > Mumbai</option>
                <option value="Maharashtra, Nagpur">Maharashtra > Nagpur</option>
                <option value="Maharashtra, Pune">Maharashtra > Pune</option>
                <option value="Orissa, Bhubaneswar">Orissa > Bhubaneswar</option>
                <option value="Orissa, Cuttack">Orissa > Cuttack</option>
                <option value="Orissa, Rourkela">Orissa > Rourkela</option>
                <option value="Puducherry, Puducherry">Puducherry > Puducherry</option>
                <option value="Punjab, Amritsar">Punjab > Amritsar</option>
                <option value="Punjab, Jalandhar">Punjab > Jalandhar</option>
                <option value="Punjab, Ludhiana">Punjab > Ludhiana</option>
                <option value="Punjab, Patiala">Punjab > Patiala</option>
                <option value="Rajasthan, Ajmer">Rajasthan > Ajmer</option>
                <option value="Rajasthan, Jaipur">Rajasthan > Jaipur</option>
                <option value="Rajasthan, Jodhpur">Rajasthan > Jodhpur</option>
                <option value="Rajasthan, Udaipur">Rajasthan > Udaipur</option>
                <option value="Tamil Nadu, Chennai">Tamil Nadu > Chennai</option>
                <option value="Tamil Nadu, Coimbatore">Tamil Nadu > Coimbatore</option>
                <option value="Tamil Nadu, Madurai">Tamil Nadu > Madurai</option>
                <option value="Tamil Nadu, Salem">Tamil Nadu > Salem</option>
                <option value="Tamil Nadu, Tiruchirappalli">Tamil Nadu > Tiruchirappalli</option>
                <option value="Tripura, Agartala">Tripura > Agartala</option>
                <option value="Uttar Pradesh, Agra">Uttar Pradesh > Agra</option>
                <option value="Uttar Pradesh, Allahabad">Uttar Pradesh > Allahabad</option>
                <option value="Uttar Pradesh, Bulandshahr">Uttar Pradesh > Bulandshahr</option>
                <option value="Uttar Pradesh, Ghaziabad">Uttar Pradesh > Ghaziabad</option>
                <option value="Uttar Pradesh, Kanpur">Uttar Pradesh > Kanpur</option>
                <option value="Uttar Pradesh, Lucknow">Uttar Pradesh > Lucknow</option>
                <option value="Uttar Pradesh, Noida">Uttar Pradesh > Noida</option>
                <option value="Uttar Pradesh, Varanasi">Uttar Pradesh > Varanasi</option>
                <option value="Uttarakhand, Dehradun">Uttarakhand > Dehradun</option>
                <option value="West Bengal, Asansol">West Bengal > Asansol</option>
                <option value="West Bengal, Howrah">West Bengal > Howrah</option>
                <option value="West Bengal, Kolkata">West Bengal > Kolkata</option>
                <option value="West Bengal, Siliguri">West Bengal > Siliguri</option>
              </select>
            </p>

            <p>
              <label>Industry</label>
              <%#= text_field_tag :industry, @user.industry %>
              <%#= select_tag :industry, options_for_select(%w(Accounting Animation Apparel & Fashion  Architecture&Planning Automotive Banking Biotechnology Broadcast Media Business Supplies and Equipment Capital Markets Chemicals Commercial Real Estate Construction Consumer Goods Cosmetics Design Electrical/Electronic Manufacturing Entertainment Financial Services Graphic Design Health, Wellness and Fitness Hospitality Human Resources Import and Export Information Services Information Technology and Services Insurance Legal Services Leisure, Travel & Tourism Market Research Marketing and Advertising Mining & Metals Motion Pictures and Film Non-Profit Organization Management Online Media Public Relations and Communications Real Estate Restaurants Retail Sports Telecommunications Textiles)) %>
              <%#= select_tag "industry", "<option>Red Laal</option><option>Green</option><option>Blue</option>".html_safe %>

              <%= select_tag "industry", options_for_select(["Graphic Design","Architecture & Planning", "Engineering",
                                                          "Cosmetics", "Apparel & Fashion",
                                                          "Consumer Electronics",
                                                          "Furniture",
                                                          "Retail",
                                                          "Import and Export",
                                                          "Luxury Goods & Jewelry",
                                                          "Marketing and Advertising",
                                                          "Market Research",
                                                          "Public Relations and Communications",
                                                          "Human Resources",
                                                          "Banking",
                                                          "Insurance",
                                                          "Financial Services",
                                                          "Accounting",
                                                          "Computer Hardware",
                                                          "Computer Networking",
                                                          "Telecommunications",
                                                          "Information Technology and Services",
                                                          "Chemicals",
                                                          "Mining & Metals",
                                                          "Oil & Energy",
                                                          "Textiles",
                                                          "Electrical/Electronic Manufacturing",
                                                          "Plastics",
                                                          "Packaging and Containers",
                                                          "Media",
                                                          "Animation",
                                                          "Biotechnology",
                                                          "Medical Practice",
                                                          "Hospital & Health Care",
                                                          "Pharmaceuticals",
                                                          "Veterinary",
                                                          "Consumer Services",
                                                          "Entertainment",
                                                          "Leisure, Travel & Tourism",
                                                          "Hospitality",
                                                          "Airlines/Aviation",
                                                         ], :selected => @user.industry), :prompt => "Select industry" %>
            </p>

            <!--<p>-->
              <!--<label>Password</label>-->
              <!--<%#= password_field_tag :password %>-->
            <!--</p>-->


          </div>
        </div>
      </div>
      <div class="modal-footer">
        <%= submit_tag "Update", :class => "btn btn-medium btn-primary pull-left" %>
      </div>
  <% end %>
</div>

<div id="change_pwd_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <%= form_tag :quiz_change_password do |f| %>
  <%#= form_tag :html => {:id => "chng_passd"} do |f| %>
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          ×
        </button>
        <h3>
          Enter the new password
        </h3>
      </div>
      <div class="modal-body">
        <div class="row-fluid">

          <div class="span9">

            <p>
              <label>Password</label>
              <%= password_field_tag :password %>
            </p>
            <div id="pass_text" style="display: none;color: red;">Minimum 8 Characters Required</div>
          </div>

        </div>
      </div>

      <div class="modal-footer">
        <div class = "btn btn-medium btn-primary pull-left" id ="chng_pwd_btn">Change</div>
        <%= submit_tag "Change", :class => "btn btn-medium btn-primary pull-left",:style=>"display:none;",:id=>"submit_change" %>
      </div>
  <% end %>

</div>

<div id="rec_act_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
      ×
    </button>
    <h3>
      Recent Activity
    </h3>
  </div>
  <div class="modal-body">
    <div class="row-fluid">
      <div class="span9">
        <div class="blog-categories widget-tp">
          <ul id="all_recent_activity">

          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer">

  </div>

</div>

<script>
  $(function(){

      $("#chng_pwd_btn").click(function(){
        if($("#password").val().length >= 8){
           $("#submit_change").trigger("click");
           $("#pass_text").hide();
        }
        else{
            $("#pass_text").show();
        }
      });


      $('.dependent').dependentSelects();
    <%if user_signed_in?%>






      var curr_usr_fb_sign_in_count = "<%= current_user.fb_sign_in_count %>";
      var fb_signed_in = <%= current_user.fb_signed_in %>;

        $.ajax({
          url:"/recent_activity",
          type:"get",
          success:function (returning_data) {
            if(returning_data!=''){
              returning_data=returning_data.split(",");
              $('#recent_activity').html();
              $.each(returning_data,function(){
                  recent = this.replace("[", "").replace("]", "").replace('"', '').replace('"', '').replace('"', '');
                  $("#recent_activity").append('<li class="rec_act" onclick="show_rec_act();"><a href="#">' + recent + '</a></li>');
              });
            }
          }
        });

      $.ajax({
          url: "/all_recent_activities",
          type: "get",
          success: function (returning_data) {
              if (returning_data != '') {
                  returning_data = returning_data.split(",");
                  $('#recent_activity').html();
                  $.each(returning_data, function () {
                      recent = this.replace("[", "").replace("]", "").replace('"', '').replace('"', '');
                      $("#all_recent_activity").append('<li><a href="#">' + recent + '</a></li>');
                  });
              }
          }
      });

      if ( fb_signed_in == true) {

          $.ajax({
              url:"/update_fb_sign_in_score",
              type:"get",
              success:function (returning_data) {

              }
          });

      }

        $.ajax({
          url:"/get_score",
          type:"get",
          success:function (returning_data) {
            if(returning_data!=''){
              returning_data=returning_data.split("|");

                var fb_sign_in_score = <%= current_user.fb_sign_in_score.to_i %>;
                var ref_pts = <%= current_user.refer_points.to_i %>;
                var fb_signed_in = <%= current_user.fb_signed_in %>;
                //console.log(fb_signed_in);
                if ( fb_signed_in == true) {
                    $("#points").html(ref_pts + fb_sign_in_score + " Points");
                }
                else{
                    $("#points").html(<%=current_user.refer_points%>+" Points");
                }

              $("#rank").html(<%=User.order(:refer_points).map{|i| i.refer_points}.reverse.index(current_user.refer_points)+1%>);
              $("#percentage").html(returning_data[2]+"%");
              $(".bar").width(parseInt(returning_data[2])+"%");
            }
          }
        });

        <%end%>

      //console.log($(".dependent").attr('class'));
      var curr_usr_loc = "<%= current_user.location %>";
      var replaced_loc = curr_usr_loc.replace(","," >");
      var state_loc = curr_usr_loc.split(",")[0];
      //console.log(curr_usr_loc);
      //console.log(replaced_loc);
      //console.log(state_loc);

      //<option value="Tamil Nadu, Chennai">Tamil Nadu > Chennai</option>

      //$('.dependent option:contains("+replaced_loc+")').prop('selected', true);
      //$(".dependent option[text=" + curr_usr_loc +"]").attr("selected","selected") ;
      $(".dependent option").filter(function() {
          //may want to use $.trim in here
          //console.log($(this).text());
          return $(this).text() == state_loc;
      }).attr('selected', true);



      $(".dependent-sub option").filter(function() {
          //may want to use $.trim in here
          return $(this).val() == curr_usr_loc;
//          if ( $(this).val() == curr_usr_loc){
//              $(this).show();
//          }
      }).attr('selected', true).addClass("hi");

      $(".hi").parent().show()




  });

  function change_password(){
      $('#change_pwd_modal').modal('show');
      $("#password").val("");
      $('#pass_text').hide();
  }

  function show_rec_act(){
      $("#rec_act_modal").modal('show');
  }

    var _gaq=[['_setAccount','UA-34697555-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
        s.parentNode.insertBefore(g,s)}(document,'script'));
</script>




<script>

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){

        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),

            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)

    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');



    ga('create', 'UA-44964472-1', 'winwithet.com');

    ga('send', 'pageview');



</script>